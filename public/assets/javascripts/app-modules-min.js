!function(){angular.module("services.notifications",[]).service("notificationServiceBuilder",["CableApi","funcFactory",function(t,e){this.build=function(a,r,n,o){return new function(){function a(t,e){n[t.action]&&n[t.action](e,t)}this.subscribe=function(r,n){var i=n,s={rejected:function(){e.showNotification("Канал получения уведомлений","Не удалось установить соединение!")},received:function(t){window.gon.user.id!==t.user_id&&a(t,i)}};"object"==typeof o&&o&&(s=angular.extend(s,o)),t.subscribe(r,s)}}},this.getIndexByProperty=function(t,e,a){for(var r=-1,n=t.length;n--;)if(t[n][a]===e[a]){r=n;break}return r}}])}(),function(){"use strict";var t=angular.module("app.articles",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.articles",{url:"/articles?q",data:{title:"Статья",access:{action:"index",params:"Article"}},params:{q:""},views:{"content@app":{controller:"ArticlesCtrl",templateUrl:"/app/articles/views/articles.html"}}})}])}(),function(){"use strict";var t=angular.module("login",["ui.router"]);t.config(["$stateProvider",function(t){t.state("login",{url:"/sign_in",views:{root:{controller:"loginCtrl",templateUrl:"/app/auth/views/login.html"}}})}])}(),function(){"use strict";var t=angular.module("app.catalogues",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.catalogues",{url:"/catalogues?q",data:{title:"Категории товаров",access:{action:"index",params:"Catalogue"}},params:{q:""},views:{"content@app":{controller:"CataloguesCtrl",templateUrl:"/app/catalogues/views/catalogues.html"}}}).state("app.catalogues.view",{url:"/:id",data:{access:{action:"read",params:"Catalogue"}},views:{"content@app":{controller:"ViewCatalogueCtrl",templateUrl:"/app/catalogues/views/viewCatalogue.html"}}}).state("app.catalogues.view.edit",{url:"/edit",data:{title:"Редактирование категории",access:{action:"edit",params:"Catalogue"}},views:{"content@app":{controller:"EditCatalogueCtrl",templateUrl:"/app/catalogues/views/editCatalogue.html"}}})}])}(),function(){"use strict";var t=angular.module("app.contacts",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.contacts",{url:"/contacts?q",data:{title:"Контакты",access:{action:"index",params:"Contact"}},views:{"content@app":{controller:"ContactsCtrl",templateUrl:"/app/contacts/views/contacts.html"}}}).state("app.contacts.view",{url:"/:id",data:{title:"Просмотр контакта",access:{action:"read",params:"Contact"}},views:{"content@app":{controller:"ViewContactCtrl",templateUrl:"/app/contacts/views/viewContact.html"}}}).state("app.contacts.view.edit",{url:"/edit",data:{title:"Редактирования контакта",access:{action:"edit",params:"Contact"}},views:{"content@app":{controller:"EditContactCtrl",templateUrl:"/app/contacts/views/editContact.html"}}})}])}(),function(){"use strict";var t=angular.module("app.customer_orders",["ui.router","easypiechart","services.notifications"]);t.config(["$stateProvider",function(t){t.state("app.customer_orders",{url:"/customer_orders?q",data:{title:"Заказы",access:{action:"index",params:"CustomerOrder"}},params:{q:"",id:""},views:{"content@app":{controller:"CustomerOrdersCtrl",templateUrl:"/app/customer_orders/views/customerOrders.html"}}}).state("app.customer_orders.view",{url:"/:id",data:{title:"Просмотр заказа",access:{action:"read",params:"CustomerOrder"}},views:{"content@app":{controller:"ViewCustomerOrderCtrl",templateUrl:"/app/customer_orders/views/viewCustomerOrder.html"}}}).state("app.customer_orders.view.edit",{url:"/edit",data:{title:"Редактирование заказа",access:{action:"edit",params:"CustomerOrder"}},views:{"content@app":{controller:"EditCustomerOrder",templateUrl:"/app/customer_orders/views/editCustomerOrder.html"}}}).state("app.customer_orders.view.logs",{url:"/logs",data:{title:"История заказа",access:{action:"logs",params:"CustomerOrder"}},views:{"content@app":{controller:"LogsCustomerOrderCtrl",templateUrl:"/app/customer_orders/views/logsCustomerOrder.html"}}})}]),t.factory("customerOrdersNotifications",["notificationServiceBuilder","funcFactory",function(e,a){var r={create:function(t,e){var r=e.data;t.push(r),a.showNotification("Добавлен продукт",r.product.name+" добавлен другим пользователем.",!0)},update:function(t,r){var n=r.data,o=e.getIndexByProperty(t,n,"id");o>-1&&(t[o]=n),a.showNotification("Обновлена инофрмация по продукту",n.product.name+" обновлен другим пользователем.",!0)},destroy:function(t,r){var n=r.data,o=e.getIndexByProperty(t,n,"id");o>-1&&t.splice(o,1),a.showNotification("Удален продукт","Продукт удален другим пользователем.")}};return e.build(t,"customerOrdersNotifications",r)}])}(),function(){"use strict";var t=angular.module("app.dashboard",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.dashboard",{url:"/dashboard",views:{"content@app":{controller:"DashboardCtrl",templateUrl:"/app/dashboard/views/dashboard.html"}},data:{title:"Рабочий стол"}})}])}(),function(){"use strict";var t=angular.module("app.dispatch_orders",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.dispatch_orders",{url:"/dispatch_orders?q",data:{title:"Списания",access:{action:"index",params:"DispatchOrder"}},params:{q:""},views:{"content@app":{controller:"DispatchOrdersCtrl",templateUrl:"/app/dispatch_orders/views/dispatch_orders.html"}}}).state("app.dispatch_orders.view",{url:"/:id",data:{title:"Просмотр списания",access:{action:"read",params:"DispatchOrder"}},views:{"content@app":{controller:"ViewDispatchOrderCtrl",templateUrl:"/app/dispatch_orders/views/viewDispatchOrder.html"}}})}])}(),function(){"use strict";var t=angular.module("app.incoming_transfers",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.incoming_transfers",{url:"/incoming_transfers?q",data:{title:"Входящие платежи",access:{action:"index",params:"IncomingTransfer"}},params:{q:"",id:""},views:{"content@app":{controller:"IncomingTransfersCtrl",templateUrl:"/app/incoming_transfers/views/transfers.html"}}}).state("app.incoming_transfers.view",{url:"/:id",data:{title:"Просмотр входящего платежа",access:{action:"read",params:"IncomingTransfer"}},views:{"content@app":{controller:"ViewIncomingTransferCtrl",templateUrl:"/app/incoming_transfers/views/viewIncomingTransfer.html"}}}).state("app.incoming_transfers.view.edit",{url:"/edit",data:{title:"Редактирование входящего платежа",access:{action:"edit",params:"IncomingTransfer"}},views:{"content@app":{controller:"EditIncomingTransferCtrl",templateUrl:"/app/incoming_transfers/views/editIncomingTransfer.html"}}})}])}(),function(){"use strict";var t=angular.module("app.layout",["ui.router","app.templates"]);return t.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("app",{"abstract":!0,views:{root:{templateUrl:"/app/layout/layout.tpl.html"}}}),e.otherwise(function(){return window.authorized?"/dashboard":""})}]),t.controller("LayoutCtrl",["$scope","$state","serverApi",function(t,e,a){var r=t;r.searchText="",r.executeSearch=function(){e.go("app.search",{searchString:r.searchText,page:0})},r.signOut=a.signOut}]),t.controller("LayoutNavigationCtrl",["$scope",function(t){t.index=window.gon.index}]),t}(),function(){"use strict";var t=angular.module("app.manufacturers",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.manufacturers",{url:"/manufacturers?q",data:{title:"Производители",access:{action:"index",params:"Manufacturers"}},params:{q:""},views:{"content@app":{controller:"ManufacturersCtrl",templateUrl:"/app/manufacturers/views/manufacturers.html"}}}).state("app.manufacturers.view",{url:"/:id",data:{title:"Просмотр производителя",access:{action:"read",params:"Manufacturers"}},views:{"content@app":{controller:"ViewManufacturerCtrl",templateUrl:"/app/manufacturers/views/viewManufacturer.html"}}}).state("app.manufacturers.view.edit",{url:"/edit",data:{title:"Редактирование производителя",access:{action:"edit",params:"Manufacturer"}},views:{"content@app":{controller:"EditManufacturerCtrl",templateUrl:"/app/manufacturers/views/editManufacturer.html"}}})}])}(),function(){"use strict";var t=angular.module("app.news",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.news",{url:"/news?q",data:{title:"Новости",access:{action:"index",params:"News"}},params:{q:""},views:{"content@app":{controller:"NewsCtrl",templateUrl:"/app/news/views/news.html"}}})}])}(),function(){"use strict";var t=angular.module("app.outgoing_transfers",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.outgoing_transfers",{url:"/outgoing_transfers?q",data:{title:"Исходящие платежи",access:{action:"index",params:"OutgoingTransfer"}},params:{q:""},views:{"content@app":{controller:"OutgoingTransfersCtrl",templateUrl:"/app/outgoing_transfers/views/transfers.html"}}}).state("app.outgoing_transfers.view",{url:"/:id",data:{title:"Просмотр исходящего платежа",access:{action:"read",params:"OutgoingTransfer"}},views:{"content@app":{controller:"ViewOutgoingTransferCtrl",templateUrl:"/app/outgoing_transfers/views/viewOutgoingTransfer.html"}}}).state("app.outgoing_transfers.view.edit",{url:"/edit",data:{title:"Редактирование исходящего платежа",access:{action:"edit",params:"OutgoingTransfer"}},views:{"content@app":{controller:"EditOutgoingTransferCtrl",templateUrl:"/app/outgoing_transfers/views/EditOutgoingTransfer.html"}}})}])}(),function(){"use strict";var t=angular.module("app.pages",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.pages",{url:"/pages?q",data:{title:"Статичные страницы",access:{action:"index",params:"Page"}},params:{q:""},views:{"content@app":{controller:"PagesCtrl",templateUrl:"/app/pages/views/pages.html"}}}).state("app.pages.view",{url:"/:id",data:{access:{action:"read",params:"Page"}},views:{"content@app":{controller:"ViewPageCtrl",templateUrl:"/app/pages/views/viewPage.html"}}}).state("app.pages.edit",{url:"/edit",data:{title:"Изменить страницу",access:{action:"edit",params:"Page"}},params:{q:""},views:{"content@app":{controller:"EditPageCtrl",templateUrl:"/app/pages/views/editPage.html"}}})}])}(),function(){"use strict";var t=angular.module("app.partners",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.partners",{url:"/partners?q",data:{title:"Партнёры",access:{action:"index",params:"Partner"}},params:{q:""},views:{"content@app":{controller:"PartnersCtrl",templateUrl:"/app/partners/views/partners.html"}}}).state("app.partners.view",{url:"/:id",data:{access:{action:"show",params:"Partner"}},views:{"content@app":{controller:"ViewPartnerCtrl",templateUrl:"/app/partners/views/showPartner.html"}}}).state("app.partners.view.edit",{url:"/edit",data:{title:"Редактирование партнёра",access:{action:"edit",params:"Partner"}},views:{"content@app":{controller:"EditPartnerCtrl",templateUrl:"/app/partners/views/editPartner.html"}}})}]),t.filter("innKpp",function(){return function(t,e){return t&&e?t.toString()+"/"+e.toString():""}})}(),function(){"use strict";var t=angular.module("app.pdf_catalogues",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.pdf_catalogues",{url:"/pdf_catalogues?q",data:{title:"PDF Каталоги",access:{action:"index",params:"pdf_catalogues"}},params:{q:""},views:{"content@app":{controller:"PdfCataloguesCtrl",templateUrl:"/app/pdf_catalogues/views/pdf_catalogues.html"}}}).state("app.pdf_catalogues.view",{url:"/:id",data:{title:"Просмотр производителя",access:{action:"read",params:"pdf_catalogues"}},views:{"content@app":{controller:"ViewPdfCatalogueCtrl",templateUrl:"/app/pdf_catalogues/views/viewPdfCatalogue.html"}}})}])}(),function(){"use strict";var t=angular.module("app.products",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.product",{url:"/products/:id",params:{id:""},data:{title:"Продукт",access:{action:"read",params:"Product"}},views:{"content@app":{controller:"ProductCtrl",templateUrl:"/app/products/views/show_product.html"}}}).state("app.product.edit",{url:"/edit",params:{id:""},data:{title:"Редактирование продукта",access:{action:"edit",params:"Product"}},views:{"content@app":{controller:"EditProductCtrl",templateUrl:"/app/products/views/edit_product.html"}}}).state("app.product.partner_logs",{url:"/partner_logs",params:{id:""},data:{title:"История товара",access:{action:"read",params:"PartnerLog"}},views:{"content@app":{controller:"PartnerLogsProductCtrl",templateUrl:"/app/products/views/partner_logs.html"}}}).state("app.product.supplier_infos",{url:"/supplier_infos",params:{id:""},data:{title:"История товара",access:{action:"supplier_infos",params:"Product"}},views:{"content@app":{controller:"SupplierInfosProductCtrl",templateUrl:"/app/products/views/supplier_infos.html"}}})}])}(),function(){"use strict";var t=angular.module("app.receive_orders",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.receive_orders",{url:"/receive_orders?q",data:{title:"Поступление",access:{action:"index",params:"ReceiveOrder"}},params:{q:""},views:{"content@app":{controller:"ReceiveOrdersCtrl",templateUrl:"/app/receive_orders/views/receive_orders.html"}}}).state("app.receive_orders.view",{url:"/:id",data:{title:"Просмотр поступления",access:{action:"read",params:"ReceiveOrder"}},views:{"content@app":{controller:"ViewReceiveOrderCtrl",templateUrl:"/app/receive_orders/views/viewReceiveOrder.html"}}}).state("app.receive_orders.view.edit",{url:"/edit",data:{title:"Редактирование поступления",access:{action:"edit",params:"ReceiveOrder"}},views:{"content@app":{controller:"EditReceiveOrderCtrl",templateUrl:"/app/receive_orders/views/editReceiveOrder.html"}}})}])}(),function(){"use strict";var t=angular.module("app.search",["ui.router"]);t.config(["$stateProvider",function(t){t.state("app.search",{url:"/search=*searchString",params:{searchString:""},data:{title:"Поиск"},views:{"content@app":{controller:"TopSearchCtrl",templateUrl:"/app/search/views/search.html"}}})}])}(),function(){"use strict";var t=angular.module("app.supplier_orders",["ui.router","easypiechart"]);t.config(["$stateProvider",function(t){t.state("app.supplier_orders",{url:"/supplier_orders?q",data:{title:"Заказы поставщикам",access:{action:"index",params:"SupplierOrder"}},params:{q:""},views:{"content@app":{controller:"SupplierOrdersCtrl",templateUrl:"/app/supplier_orders/views/supplierOrders.html"}}}).state("app.supplier_orders.view",{url:"/:id",data:{title:"Просмотр заказа",access:{action:"read",params:"SupplierOrder"}},views:{"content@app":{controller:"ViewSupplierOrderCtrl",templateUrl:"/app/supplier_orders/views/viewSupplierOrder.html"}}}).state("app.supplier_orders.view.edit",{url:"/edit",data:{title:"Редактирование заказа",access:{action:"write",params:"SupplierOrder"}},views:{"content@app":{controller:"EditSupplierOrderCtrl",templateUrl:"/app/supplier_orders/views/editSupplierOrder.html"}}})}])}(),function(){"use strict";angular.module("app.layout").factory("User",["$http","$q",function(t,e){var a=e.defer(),r={dfd:a,initialized:a.promise,username:"Пользователь",picture:"/assets/smart_admin/avatars/male.png"};return r}])}(),function(){"use strict";angular.module("app.layout").directive("loginInfo",["User",function(t){return{restrict:"A",templateUrl:"/app/auth/directives/login-info.tpl.html",link:function(e){t.initialized.then(function(){e.user=t})}}}])}(),function(){"use strict";var t=angular.module("app.templates",[]);t.run(["$templateCache",function(t){t.put("ordersFilter.tmpl.html",'<div class="smart-form col-xs-12 col-md-6 col-lg-5 no-padding"><section><label class="label">Запрос</label><label class="input"><input type="text" ng-model="searchQuery" placeholder="Введите часть номера" class="input-sm" ng-keypress="exeSearch($event)"></label></section></div><button class="btn btn-primary un-float margin-bottom-10" ng-click="exeSearch()"><i class="fa fa-search"></i> Поиск</button>'),t.put("formNavButtons.tmpl.html",'<div ng-repeat="item in buttons track by $index" ng-if="item.hasOwnProperty(\'disabled\') || !item.role || role[item.role] === true" ng-disabled="item.disabled" ng-class="item.class" ng-click="buttonClick(item)"><i class="fa fa-{{item.ico}}"></i><span class="hidden-xs">{{item.name}}</span></div>')}])}(),function(){"use strict";angular.module("app.layout").directive("fullScreen",function(){return{restrict:"A",link:function(t,e){var a=$("body"),r=function(t){a.hasClass("full-screen")?(a.removeClass("full-screen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(a.addClass("full-screen"),document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen())};e.on("click",r)}}})}(),function(){"use strict";angular.module("app.layout").directive("minifyMenu",function(){return{restrict:"A",link:function(t,e){var a=$("body"),r=function(){a.hasClass("menu-on-top")||(a.toggleClass("minified"),a.removeClass("hidden-menu"),$("html").removeClass("hidden-menu-mobile-lock"))};e.on("click",r)}}})}(),function(){"use strict";angular.module("app.layout").directive("reloadState",["$rootScope",function(t){return{restrict:"A",compile:function(e,a){e.removeAttr("reload-state data-reload-state"),e.on("click",function(e){t.$state.transitionTo(t.$state.current,t.$stateParams,{reload:!0,inherit:!1,notify:!0}),e.preventDefault()})}}}])}(),function(){"use strict";angular.module("app.layout").directive("resetWidgets",["$state",function(t){return{restrict:"A",link:function(t,e){e.on("click",function(){$.SmartMessageBox({title:"<i class='fa fa-refresh' style='color:green'></i> Clear Local Storage",content:"Would you like to RESET all your saved widgets and clear LocalStorage?1",buttons:"[No][Yes]"},function(t){"Yes"==t&&localStorage&&(localStorage.clear(),location.reload())})})}}}])}(),function(){"use strict";angular.module("app.layout").directive("searchMobile",function(){return{restrict:"A",compile:function(t,e){t.removeAttr("search-mobile data-search-mobile"),t.on("click",function(t){$("body").addClass("search-mobile"),t.preventDefault()}),$("#cancel-search-js").on("click",function(t){$("body").removeClass("search-mobile"),t.preventDefault()})}}})}(),function(){"use strict";angular.module("app.layout").directive("toggleMenu",function(){return{restrict:"A",link:function(t,e){var a=$("body"),r=function(){a.hasClass("menu-on-top")?a.hasClass("menu-on-top")&&a.hasClass("mobile-view-activated")&&($("html").toggleClass("hidden-menu-mobile-lock"),a.toggleClass("hidden-menu"),a.removeClass("minified")):($("html").toggleClass("hidden-menu-mobile-lock"),a.toggleClass("hidden-menu"),a.removeClass("minified"))};e.on("click",r),t.$on("requestToggleMenu",function(){r()})}}})}(),function(){var t=angular.module("app.layout");t.directive("modelFilter",["$filter",function(t){return{restrict:"A",require:"ngModel",link:function(e,a,r,n){var o={};e.$watch(r.modelFilter,function(t){o=t},!0),e.$watch(r.ngModel,function(e,a){e!==a&&(n.$setViewValue(t(r.filterName)(e,o)),n.$render())})}}}]),t.filter("price_net",function(){return function(t,e){var a=0;return t.hasOwnProperty("price")&&(a=t.price*(t.hasOwnProperty("discount")?1-t.discount/100:1),e>=0&&(a*=e)),a}}),t.filter("te_number",function(){return function(t,e){var a=(t||"").toString(),r=e.hasOwnProperty("number");if(""===a||r&&a.indexOf(".")==a.length-1||r&&"0"==a[a.length-1])return t;var n=(e.hasOwnProperty("number")?parseFloat:parseInt)(t||0)||0;return e.hasOwnProperty("min")&&n<e.min?e.min:e.hasOwnProperty("max")&&n>e.max?e.max:n}})}(),function(){var t=angular.module("app.layout");t.service("funcFactory",function(){this.showNotification=function(t,e,a){var r=a||"object"!=typeof e?e:Object.keys(e).map(function(t){return t+" "+e[t]}).join("\n");$.smallBox({title:t,iconSmall:"fa fa-check fa-2x fadeInRight animated",content:'<i class="fa fa-edit"></i> <i>'+r+"</i>",color:a?"#739E73":"#C46A69",timeout:4e3})},this.setPageTitle=function(t){angular.element("html head title").text(t)},this.getPercent=function(t,e){return(t/e*100||0).toFixed(0)},this.getTinymceOptions=function(){return{plugins:"advlist autolink link image lists charmap preview textcolor colorpicker code",toolbar1:"insertfile undo redo | preview code | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",language:"ru",menubar:!1}}}),t.service("serverApi",["$http",function(t){this.getDashboard=function(e,a){t.get("/back/dashboard").then(e,a)},this.getSearch=function(e,a,r,n,o){var i=encodeURIComponent(a);t.get("/admin/search.json?term="+i+"&$skip="+25*e+"&$top=25",r||null).then(n,o)},this.getProduct=function(e,a,r){t.get("/api/products/"+e+".json").then(a,r)},this.updateProduct=function(e,a,r,n){t.patch("/api/products/"+e,a).then(r,n)},this.getProductPartnerLogs=function(e,a,r){t.get("/api/products/"+e+"/partner_logs.json").then(a,r)},this.deleteProductPartnerLog=function(e,a,r,n){t["delete"]("/api/products/"+e+"/partner_logs/"+a).then(r,n)},this.getProductSupplierInfos=function(e,a,r){t.get("/api/products/"+e+"/supplier_infos.json").then(a,r)},this.getCustomerOrders=function(e,a,r,n,o){var i="/api/customer_orders?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createCustomerOrder=function(e,a,r){t.post("/api/customer_orders",e).then(a,r)},this.deleteCustomerOrder=function(e,a,r){t["delete"]("/api/customer_orders/"+e).then(a,r)},this.getCustomerOrderDetails=function(e,a,r){t.get("/api/customer_orders/"+e).then(a,r)},this.updateCustomerOrder=function(e,a,r,n){t.put("/api/customer_orders/"+e,a).then(r,n)},this.addCustomerOrderProduct=function(e,a,r,n){t.post("/api/customer_orders/"+e+"/customer_order_contents",a).then(r,n)},this.updateCustomerOrderProduct=function(e,a,r,n,o){t.put("/api/customer_orders/"+e+"/customer_order_contents/"+a,r).then(n,o)},this.removeCustomerOrderProduct=function(e,a,r,n){t["delete"]("/api/customer_orders/"+e+"/customer_order_contents/"+a).then(r)},this.getCustomerOrderLogs=function(e,a,r){t.get("/api/customer_orders/"+e+"/logs").then(a,r)},this.sendCustomerOrderInvoice=function(e,a,r){t.put("/api/customer_orders/"+e+"/send_invoice").then(a,r)},this.recalculateCustomerOrder=function(e,a,r){t.get("/api/customer_orders/"+e+"/recalculate").then(a,r)},this.updateStatusCustomerOrder=function(e,a,r,n){t.put("/api/customer_orders/"+e+"/update_status",a).then(r,n)},this.updateCommandCustomerOrder=function(e,a,r,n){t.put("/api/customer_orders/"+e+"/update_command",a).then(r,n)},this.getSupplierOrders=function(e,a,r,n,o){var i="/api/supplier_orders?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createSupplierOrder=function(e,a,r){t.post("/api/supplier_orders",e).then(a,r)},this.deleteSupplierOrder=function(e,a,r){t["delete"]("/api/supplier_orders/"+e).then(a,r)},this.getSupplierOrderDetails=function(e,a,r){t.get("/api/supplier_orders/"+e).then(a,r)},this.updateSupplierOrder=function(e,a,r,n){t.put("/api/supplier_orders/"+e,a).then(r,n)},this.addSupplierOrderProduct=function(e,a,r,n){t.post("/api/supplier_orders/"+e+"/supplier_order_contents",a).then(r,n)},this.updateSupplierOrderProduct=function(e,a,r,n,o){t.put("/api/supplier_orders/"+e+"/supplier_order_contents/"+a,r).then(n,o)},this.removeSupplierOrderProduct=function(e,a,r,n){t["delete"]("/api/supplier_orders/"+e+"/supplier_order_contents/"+a).then(r)},this.automaticallyCreateSupplierOrders=function(e,a){t.post("/api/supplier_orders/mass_make").then(e,a)},this.updateStatusSupplierOrder=function(e,a,r,n){t.put("/api/supplier_orders/"+e+"/update_status",a).then(r,n)},this.getCatalogues=function(e,a,r,n,o){var i="/api/catalogues?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getCatalogueDetails=function(e,a,r){t.get("/api/catalogues/"+e).then(a,r)},this.updateCatalogue=function(e,a,r,n){t.put("/api/catalogues/"+e,a).then(r,n)},this.deleteCatalogue=function(e,a,r){t["delete"]("/api/catalogues/"+e).then(a,r)},this.getManufacturers=function(e,a,r,n,o){var i="/api/manufacturers?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getManufacturerDetails=function(e,a,r){t.get("/api/manufacturers/"+e).then(a,r)},this.updateManufacturer=function(e,a,r,n){t.put("/api/manufacturers/"+e,a).then(r,n)},this.deleteManufacturer=function(e,a,r){t["delete"]("/api/manufacturers/"+e).then(a,r)},this.getPdfCatalogues=function(e,a,r,n,o){var i="/api/pdf_catalogues?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getPdfCatalogueDetails=function(e,a,r){t.get("/api/pdf_catalogues/"+e).then(a,r)},this.deletePdfCatalogue=function(e,a,r){t["delete"]("/api/pdf_catalogues/"+e).then(a,r)},this.getIncomingTransfers=function(e,a,r,n,o){var i="/api/incoming_transfers?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createIncomingTransfer=function(e,a,r){t.post("/api/incoming_transfers",e).then(a,r)},this.getIncomingTransferDetails=function(e,a,r){t.get("/api/incoming_transfers/"+e).then(a,r)},this.appendIncomingTransferOrder=function(e,a,r,n){t.post("/api/incoming_transfers/"+e+"/money_to_orders",a).then(r,n)},this.removeIncomingTransferOrder=function(e,a,r,n){t["delete"]("/api/incoming_transfers/"+e+"/money_to_orders/"+a).then(r,n)},this.deleteIncomingTransfer=function(e,a,r){t["delete"]("/api/incoming_transfers/"+e).then(a,r)},this.getOutgoingTransfers=function(e,a,r,n,o){var i="/api/outgoing_transfers?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createOutgoingTransfer=function(e,a,r){t.post("/api/outgoing_transfers",e).then(a,r)},this.getOutgoingTransferDetails=function(e,a,r){t.get("/api/outgoing_transfers/"+e).then(a,r)},this.appendOutgoingTransferOrder=function(e,a,r,n){t.post("/api/outgoing_transfers/"+e+"/outgoing_money_distributions",a).then(r,n)},this.removeOutgoingTransferOrder=function(e,a,r,n){t["delete"]("/api/outgoing_transfers/"+e+"/outgoing_money_distributions/"+a).then(r,n)},this.deleteOutgoingTransfer=function(e,a,r){t["delete"]("/api/outgoing_transfers/"+e).then(a,r)},this.getPartners=function(e,a,r,n,o){var i="/api/partners?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getPartnerDetails=function(e,a,r){t.get("/api/partners/"+e).then(a,r)},this.updatePartner=function(e,a,r,n){t.put("/api/partners/"+e,a).then(r,n)},this.createPartner=function(e,a,r){t.post("/api/partners/",e).then(a,r)},this.createPerson=function(e,a,r,n){t.post("/api/partners/"+e+"/people",a).then(r,n)},this.getContacts=function(e,a,r,n,o){var i="/api/contacts?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createContact=function(e,a,r){t.post("/api/contacts",e).then(a,r)},this.getContactDetails=function(e,a,r){t.get("/api/contacts/"+e).then(a,r)},this.updateContact=function(e,a,r,n){t.put("/api/contacts/"+e,a).then(r,n)},this.getDispatchOrders=function(e,a,r,n,o){var i="/api/dispatch_orders?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getDispatchOrderDetails=function(e,a,r){t.get("/api/dispatch_orders/"+e).then(a,r)},this.updateDispatchOrder=function(e,a,r,n){t.put("/api/dispatch_orders/"+e,a).then(r,n)},this.updateStatusDispatchOrder=function(e,a,r,n){t.put("/api/dispatch_orders/"+e+"/update_status",a).then(r,n)},this.getReceiveOrders=function(e,a,r,n,o){var i="/api/receive_orders?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.createReceiveOrder=function(e,a,r){t.post("/api/receive_orders/",e).then(a,r)},this.getReceiveOrderDetails=function(e,a,r){t.get("/api/receive_orders/"+e).then(a,r)},this.updateReceiveOrder=function(e,a,r,n){t.put("/api/receive_orders/"+e,a).then(r,n)},this.getUnreceivedProducts=function(e,a,r,n,o){t.get("/api/receive_orders/"+e+"/unreceived_products?q="+a,r).then(n,o)},this.createReceiveOrderContents=function(e,a,r,n){t.post("/api/receive_orders/"+e+"/product_order_contents",a).then(r,n)},this.updateReceiveOrderContents=function(e,a,r,n,o){t.put("/api/receive_orders/"+e+"/product_order_contents/"+a,r).then(n,o)},this.deleteReceiveOrderContents=function(e,a,r,n){t["delete"]("/api/receive_orders/"+e+"/product_order_contents/"+a).then(r,n)},this.deleteReceiveOrder=function(e,a,r){t["delete"]("/api/receive_orders/"+e).then(a,r)},this.getLeadTime=function(e,a,r,n){var o="/api/products/"+e+"/lead_time?quantity="+a;t.get(o).then(r,n)},this.deleteFile=function(e,a,r,n,o){t["delete"]("/api/"+e+"/"+a+"/documents/"+r).then(n,o)},this.deleteImage=function(e,a,r,n,o){t["delete"]("/api/"+e+"/"+a+"/image").then(n,o)},this.getPages=function(e,a,r,n,o){var i="/api/pages?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getPageDetails=function(e,a,r){t.get("/api/pages/"+e).then(a,r)},this.getArticles=function(e,a,r,n,o){var i="/api/articles?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.getNews=function(e,a,r,n,o){var i="/api/news?page="+e+(a?"&q="+a:"");t.get(i,r).then(n,o)},this.signOut=function(){t["delete"]("/users/sign_out").then(function(){window.location.reload()})},this.signIn=function(e,a,r){t.post("/users/sign_in",e).then(a,r)},this.resetPassword=function(e,a,r){t.post("/users/password",e).then(a,r)},this.getAbilities=function(e,a){t.get("/api/system_info").then(e,a)}}]),t.factory("Abilities",["serverApi","$q","$state","CanCan","User",function(t,e,a,r,n){function o(){n.username=window.gon.user.first_name+" "+window.gon.user.last_name,n.dfd.resolve()}var i,s,c=e.defer(),l={get ready(){return c.promise}};window.gon&&o(),l.getGon=function(t,e){i=t,s=e,d()};var d=function(){t.getAbilities(function(t){window.gon=t.data,r.getAbility(window.gon),o(),c.resolve(),a.go(i,s)}),d=angular.noop};return l}]),t.service("CableApi",["Abilities",function(t){function e(){a.consumer=new Cable.Consumer(window.gon.websocket_url)}var a=this;window.gon?e():t.ready.then(function(){e()}),this.subscribe=function(t,e){return a.consumer.subscriptions.create(t,e)}}])}(),function(){"use strict";angular.module("app.layout").directive("bigBreadcrumbs",function(){return{restrict:"E",replace:!0,template:'<div><h1 class="page-title txt-color-blueDark"></h1></div>',scope:{items:"=",icon:"@"},link:function(t,e){var a=_.first(t.items),r=t.icon||"home";e.find("h1").append('<i class="fa-fw fa fa-'+r+'"></i> '+a),_.rest(t.items).forEach(function(t){e.find("h1").append(" <span>> "+t+"</span>")})}}})}(),function(){angular.module("app.layout").directive("clickOut",["$window","$parse",function(t,e){return{restrict:"A",link:function(a,r,n){function o(e){r[0].contains(e.target)||e.target.contains(r[0])||!t.document.contains(e.target)||(i(a,{$event:e}),!a.$$phase&&a.$apply())}var i=e(n.clickOut),s=angular.element(t).on("click",o);a.$on("$destroy",function(){s.off("click",o)})}}}])}(),function(){angular.module("app.layout").directive("fileInput",["$parse",function(t){return{restrict:"A",link:function(e,a,r){function n(t){i?o.assign(e,t):o(t)}var o=t(r.fileInput)(e),i="function"!=typeof o;a.bind("change",function(){e.$apply(function(){var t=a[0].files;r.multiple||(t=t[0]),n(t)})}),e.$on("$destroy",function(){a.unbind()})}}}])}(),function(){angular.module("app.layout").directive("fileWorker",["funcFactory","CanCan",function(t,e){return{restrict:"E",scope:{trigger:"=",config:"="},link:function(a,r){function n(t){t.hasOwnProperty("r_get")?t.r_get(t.view,t.id,function(t){!t.data.errors&&o(t.data)}):o(t.files)}function o(t){var e=g.dropzone;if(e.removeAllFiles(!0),angular.isArray(t)){var a=t.map(function(t){if(null!==t&&"object"==typeof t){var a={name:t.title,size:t.file_size,id:t.id};return e.emit("addedfile",a),e.emit("thumbnail",a,"/uploads/"+t.id+"/preview"+s(t.title).extension),a}});e.serverFiles=a}}function i(t){var e=$(t.previewElement),r=e.find("span[data-dz-name]")[t.id?"show":"hide"]();if(t.id){var n="/uploads/"+t.id+"/original"+s(t.name).extension,o=$("<a/>",{"class":"dz-download",href:n,text:"Скачать",download:t.name});e.find(".dz-filename-input").remove(),e.find(".dz-error-message").after(o),e.find("[data-dz-name]").attr("title",t.name)}else{var i=e.find(".dz-filename"),c=s(t.title=r.text()),l=$("<textarea>",{type:"text",
placeholder:"Имя файла","class":"form-control dz-filename-input",val:c.name}).on("change",function(){r.text(t.title=l.val()+c.extension)});i.append(l),a.fullQueue=!0,!a.$$phase&&a.$apply(angular.noop)}}function s(t){var e=t.lastIndexOf("."),a=e>-1?t.substring(e,t.length):"",r=t.substring(0,e);return{name:r,extension:a}}function c(){var t=g.dropzone;0==t.getQueuedFiles().length&&0==t.getUploadingFiles().length&&(a.fullQueue=!1,!a.$$phase&&a.$apply(angular.noop))}function l(){var e=this;e.cutExtension=s,h&&e.on("removedfile",function(e){e.id&&f.r_delete(f.view,f.id,e.id,function(a){a.data.errors&&t.showNotification("Не удалось удалить файл "+e.name,a.data.errors)}),c()}),e.on("addedfile",i),e.on("queuecomplete",c),f.hasOwnProperty("init")&&f.init.bind(this)()}function d(e){if(e.xhr){var a;try{a=JSON.parse(e.xhr.response)}catch(r){a={},console.log(r)}finally{a.id&&!a.errors?(e.id=a.id,i(e)):(this.removeFile(e),t.showNotification("Не удалось загрузить файл: "+e.title,a.errors||{})),f.hasOwnProperty("complete")&&f.complete.bind(this)(e)}}}function u(t,e,a){a.append("title",t.title),f.hasOwnProperty("sending")&&f.sending.bind(this)(t,e,a)}function p(t,e){var a=f.filesCount;a?this.getQueuedFiles().length<a?e():(e("Можно добавить только один файл"),this.removeFile(t)):e()}var f,m=r.find(".modal"),g=m.find("div[smart-dropzone]")[0],v=!1,h=e.can("destroy","Attachments::Document");a.fullQueue=!1,a.uploadFiles=function(){g.dropzone.processQueue()},a.trigger=function(){m.modal("show"),v&&(n(f,g.dropzone),v=!1)},a.$watch("config",function(t){if(t){f=t,v=!0;var e={url:t.url,addRemoveLinks:h,autoProcessQueue:!1,acceptedFiles:".jpg,.jpeg,.png,.gif,.txt,.doc,.docx,.odt,.xls,.xlsx,.ods,.csv,.ppt,.pptx,.odp",init:l,complete:d,sending:u,accept:p},r=t.dropzoneConfig;r&&"object"==typeof r&&(e=angular.extend(e,r)),a.options=e}})},templateUrl:"/assets/admin/app/layout/partials/fileWorker.html"}}])}(),function(){"use strict";angular.module("app.layout").directive("formNavButtons",["$templateCache",function(t){return{restrict:"E",scope:{role:"=",options:"=",subdata:"="},link:function(t,e,a){function r(){o=[],angular.isArray(i)&&i.length>0&&i.map(function(e){var a=c[e.type],r=a.role;if(a){if(a.callback=e.callback,a["class"]=l+" "+(a["class"]||""),a.hasOwnProperty("disabled")&&r&&s[r]&&(a.disabled=!s[r]),"confirm_order"===e.type)return n(t.subdata,a,o),0;o.push(a)}}),t.buttons=o}function n(t,e,a){var r=t.events;r&&angular.isArray(r)&&r.map(function(t){var r=angular.extend(t,e);a.push(r)})}var o=[],i=t.options,s=t.role||{},c={"new":{name:"Новый",ico:"plus"},show:{name:"Смотреть",ico:"search"},edit:{name:"Изменить",ico:"pencil"},files:{name:"Файлы",ico:"file"},recalculate:{name:"Пересчитать",ico:"repeat",role:"can_edit"},send_email:{name:"Отправить",ico:"envelope"},logs:{name:"История",ico:"book"},confirm_order:{ico:"check"},view:{ico:"eye","class":"btn-info",disabled:!1},remove:{ico:"trash-o","class":"btn-danger",role:"can_destroy",disabled:!0},table_edit:{ico:"pencil","class":"btn-default",role:"can_edit",disabled:!0},back:{name:"К списку",ico:"arrow-left"},upd_form_pdf:{name:"УПД",ico:"file-pdf-o"},label_pdf:{name:"Бирка",ico:"truck"},packing_list_pdf:{name:"Упаковочный лист",ico:"list-ol"},at_partners:{name:"У партнёров",ico:"exchange"},automatically:{name:"Автоматически",ico:"rocket"}},l=a.contentClass||"btn btn-success";r(),a.subdata?t.$watch("subdata",function(t){t&&Object.keys(Object(t)).length>0&&r()}):c=s=null,t.buttonClick=function(e){!e.disabled&&e.callback&&e.callback(t.subdata,e)}},template:t.get("formNavButtons.tmpl.html")}}])}(),function(){"use strict";angular.module("app.layout").directive("hrefVoid",function(){return{restrict:"A",link:function(t,e,a){e.attr("href","#"),e.on("click",function(t){t.preventDefault(),t.stopPropagation()})}}}).directive("navTabs",function(){return{restrict:"C",link:function(t,e){e.find('a[data-toggle="tab"]').each(function(t,e){var a=$(e);a.attr("data-target",a.attr("href")).removeAttr("href")})}}})}(),function(){angular.module("app.layout").directive("imgError",function(){return{restrict:"AC",link:function(t,e,a){e.bind("error",function(){a.$set("src",a.imgError),e.unbind("error")})}}})}(),function(){angular.module("app.layout").directive("notifications",["CableApi",function(t){return{restrict:"E",link:function(e,a,r){e.notifications=window.gon.notifications,e.hidden=!0,e.channel=t.subscribe("NotificationsChannel",{connected:function(t){console.info("Канал получения уведомлений настроен!")},rejected:function(t){console.info("Канал получения уведомлений. Не удалось установить соединение!")},received:function(t){e.notifications.unshift(t),e.$apply(),$.smallBox({title:"Уведомление",content:"Вам пришло новое уведомление",color:"#739E73",iconSmall:"fa fa-check fadeInRight animated",timeout:4e3})}}),e.markAsSeen=function(t){t.seen||(e.channel.perform("see",{id:t.id}),t.seen=!0)},e.markAsDeleted=function(t){t.seen&&(e.channel.perform("delete",{id:t.id}),e.notifications=_.without(e.notifications,t))},e.hide=function(){e.hidden=!0},e.show=function(){e.hidden=!1},e.toggle=function(){e.hidden=!e.hidden}},templateUrl:"/assets/admin/app/layout/partials/notifications.tpl.html"}}])}(),function(){angular.module("app.layout").directive("ordersFilter",["$templateCache","$state",function(t,e){return{restrict:"EA",scope:{searchQuery:"="},link:function(t,a,r){var n=function(){var a=t.searchQuery;e.transitionTo(r.toState,a?{q:a}:{},{reload:!0})};t.exeSearch=function(t){t?13==t.keyCode&&n():n()}},template:t.get("ordersFilter.tmpl.html")}}])}(),function(){"use strict";angular.module("app.layout").directive("radioToggle",["$log",function(t){return{scope:{model:"=ngModel",value:"@value"},link:function(t,e,a){e.parent().on("click",function(){t.model=t.value,t.$apply()})}}}])}(),function(){"use strict";angular.module("app.layout").directive("smartDeviceDetect",function(){return{restrict:"A",compile:function(t,e){t.removeAttr("smart-device-detect data-smart-device-detect");var a=/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase());t.toggleClass("desktop-detected",!a),t.toggleClass("mobile-detected",a)}}})}(),function(){"use strict";angular.module("app.layout").directive("smartDropzone",function(){return{restrict:"A",scope:{options:"=smartDropzone"},link:function(t,e){var a={addRemoveLinks:!0,dictCancelUpload:"Отменить",dictRemoveFile:"Удалить",dictDefaultMessage:'<span class="font-lg"><i class="fa fa-caret-right text-danger"></i> Перетащите файл для загрузки <br>(или Нажмите)</span>',dictResponseError:"Ошибка загрузки файла!",headers:{"X-CSRF-Token":$("meta[name=csrf-token]").attr("content"),"X-Requested-With":"XMLHttpRequest"}};t.$watch("options",function(t){t&&e.dropzone(angular.extend(a,t))})}}})}(),function(){"use strict";angular.module("app.layout").directive("smartFitAppView",["$rootScope","SmartCss",function(t,e){return{restrict:"A",compile:function(a,r){a.removeAttr("smart-fit-app-view data-smart-fit-app-view leading-y data-leading-y");var n=r.leadingY?parseInt(r.leadingY):0,o=r.smartFitAppView;if(e.appViewSize&&e.appViewSize.height){var i=e.appViewSize.height-n<252?252:e.appViewSize.height-n;e.add(o,"height",i+"px")}var s=t.$on("$smartContentResize",function(t,a){var r=a.height-n<252?252:a.height-n;e.add(o,"height",r+"px")});a.on("$destroy",function(){s(),e.remove(o,"height")})}}}])}(),function(){"use strict";angular.module("app.layout").directive("smartInclude",function(){return{replace:!0,restrict:"A",templateUrl:function(t,e){return e.smartInclude},compile:function(t){t[0].className=t[0].className.replace(/placeholder[^\s]+/g,"")}}})}(),function(){"use strict";angular.module("app.layout").directive("smartLayout",["$rootScope","$timeout","$interval","$q",function(t,e,a,r){var n=!1,o=r.defer();o.promise.then(function(){n=!0});var i,s,c,l,d=$(window),u=($(document),$("html")),p=$("body");return function f(){i=$("#header"),s=$("#left-panel"),c=$("#ribbon"),l=$(".page-footer"),_.every([i,s,c,l],function(t){return angular.isNumber(t.height())})?o.resolve():e(f,100)}(),{priority:2014,restrict:"A",compile:function(r,f){function m(){var e=p.hasClass("menu-on-top")&&s.is(":visible")?s.height():0,a=!p.hasClass("menu-on-top")&&s.is(":visible")?s.width()+s.offset().left:0,r=$("#content"),n=r.outerWidth(!0)-r.width(),o=r.outerHeight(!0)-r.height();y=d.width()-a-n,C=d.height()-e-o-i.height()-c.height()-l.height(),O=x-y,P=k-C,(Math.abs(O)||Math.abs(P)||T)&&(t.$broadcast("$smartContentResize",{width:y,height:C,deltaX:O,deltaY:P}),x=y,k=C,T=!1)}function g(t){o.promise.then(function(){h(t)})}function v(){S=!1}function h(t){e(function(){S=!0},t)}function w(){p.toggleClass("mobile-view-activated",d.width()<979),d.width()<979&&p.removeClass("minified"),m()}function b(t){t.data&&t.data.htmlId?u.attr("id",t.data.htmlId):u.removeAttr("id")}r.removeAttr("smart-layout data-smart-layout");var y,C,O,P,k=0,x=0,T=!1,S=!1;a(function(){S&&w()},300);var F=_.debounce(function(){g(300)},300);g(10),t.$on("$stateChangeStart",function(t,e,a,r,n){b(e),v()});var A=1;t.$on("$viewContentLoading",function(t,e){A++}),t.$on("$stateChangeSuccess",function(t,e,a,r,n){T=!0}),t.$on("$viewContentLoaded",function(t){A--,0==A&&n&&F()})}}}])}(),function(){"use strict";!function(t){t.fn.smartCollapseToggle=function(){return this.each(function(){var e=t("body"),a=t(this);e.hasClass("menu-on-top")||(e.hasClass("mobile-view-activated"),a.toggleClass("open"),e.hasClass("minified")?a.closest("nav ul ul").length&&(a.find(">a .collapse-sign .fa").toggleClass("fa-minus-square-o fa-plus-square-o"),a.find("ul:first").slideToggle(appConfig.menu_speed||200)):(a.find(">a .collapse-sign .fa").toggleClass("fa-minus-square-o fa-plus-square-o"),a.find("ul:first").slideToggle(appConfig.menu_speed||200)))})}}(jQuery),angular.module("app.layout").directive("smartMenu",["$state","$rootScope",function(t,e){return{restrict:"A",link:function(t,a,r){var n=$("body"),o=a.find("li[data-menu-collapse]");o.each(function(t,e){var a=$(e);a.on("click",">a",function(t){a.siblings(".open").smartCollapseToggle(),a.smartCollapseToggle(),!a.hasClass("open")&&a.find("li.active").length>0&&a.addClass("active"),t.preventDefault()}).find(">a").append('<b class="collapse-sign"><em class="fa fa-plus-square-o"></em></b>'),a.find("li.active").length&&(a.smartCollapseToggle(),a.find("li.active").parents("li").addClass("active"))}),a.on("click","a[data-ui-sref]",function(t){$(this).parents("li").addClass("active").each(function(){$(this).siblings("li.open").smartCollapseToggle(),$(this).siblings("li").removeClass("active")}),n.hasClass("mobile-view-activated")&&e.$broadcast("requestToggleMenu")}),t.$on("$smartLayoutMenuOnTop",function(t,e){e&&o.filter(".open").smartCollapseToggle()})}}}])}(),function(){"use strict";angular.module("app.layout").directive("smartPageTitle",["$rootScope","$timeout",function(t,e){return{restrict:"A",compile:function(a,r){a.removeAttr("smart-page-title data-smart-page-title");var n=r.smartPageTitle,o=function(t,a,r,o,i){var s=n;a.data&&a.data.title&&(s=a.data.title+" | "+s),e(function(){$("html head title").text(s)})};t.$on("$stateChangeStart",o)}}}])}(),function(){"use strict";angular.module("app.layout").directive("smartRouterAnimationWrap",["$rootScope","$timeout",function(t,e){return{restrict:"A",compile:function(a,r){function n(){c=!0,a.css({height:a.height()+"px",overflow:"hidden"}).addClass("active"),$(i).addClass("animated faster fadeOutDown")}function o(){c&&(a.css({height:"auto",overflow:"visible"}).removeClass("active"),$(i).addClass("animated faster fadeInUp"),c=!1,e(function(){$(i).removeClass("animated")},10))}a.removeAttr("smart-router-animation-wrap data-smart-router-animation-wrap wrap-for data-wrap-for"),a.addClass("router-animation-container"),$('<div class="router-animation-loader"><i class="fa fa-gear fa-4x fa-spin"></i></div>').appendTo(a);var i=r.wrapFor,s=r.smartRouterAnimationWrap.split(/\s/),c=!1,l=t.$on("$stateChangeStart",function(t,e,a,r,o){var i=_.any(s,function(t){return _.has(e.views,t)||_.has(r.views,t)});i&&n()}),d=t.$on("$viewContentLoaded",function(t){o()});a.on("$destroy",function(){l(),d()})}}}])}(),function(){"use strict";angular.module("app.layout").directive("stateBreadcrumbs",["$rootScope","$state",function(t,e){return{restrict:"E",replace:!0,template:'<ol class="breadcrumb"><li>Приложение</li></ol>',link:function(a,r){function n(t){var e="<li>Приложение</li>";angular.forEach(t,function(t){e+="<li>"+t+"</li>"}),r.html(e)}function o(t,a){var r=e.get(t);r&&r.data&&r.data.title&&-1==a.indexOf(r.data.title)&&a.unshift(r.data.title);var n=t.replace(/.?\w+$/,"");return n?o(n,a):a}function i(t){var e;e=t.data&&t.data.breadcrumbs?t.data.breadcrumbs:o(t.name,[]),n(e)}i(e.current),t.$on("$stateChangeStart",function(t,e){i(e)})}}}])}(),function(){angular.module("app.layout").directive("teJqUi",function(){return{restrict:"A",scope:{options:"=teJqUi"},link:function(t,e,a){var r=a.uiType;if(r&&e[r]){var n=function(t){e[r](t||{})};a.watchOptions?t.watch("options",function(t){t&&n(t)}):n(t.options),t.$on("$destroy",function(){e[r]("destroy")})}}}})}(),function(){angular.module("app.layout").directive("teLazyHelper",["serverApi",function(t){return{restrict:"A",scope:{list:"=",searchQuery:"="},link:function(e,a,r){function n(t,e){t?a.after(s):s.remove(),e&&a.after('<div class="font-lg text-align-center">Нет резульатов.</div>')}var o=r.hasOwnProperty("startPage")?parseInt(r.startPage):1,i=o,s=angular.element('<div class="font-lg text-align-center"><i class="fa fa-gear fa-spin"></i> Загрузка...</div>');e.loadList=function(){r.$set("infiniteScrollDisabled",!0),n(!0),t[r.serverApiMethod](o,e.searchQuery,{},function(t){var a=0==t.data.length;n(!1,a&&o==i),e.list=e.list.concat(t.data),o++,r.$set("infiniteScrollDisabled",a)})},r.$set("infiniteScroll",e.loadList)}}}])}(),function(){angular.module("app.layout").directive("teScrollTop",function(){return{restrict:"E",link:function(t,e){e.addClass("scroll-up-btn not-selectable"),t.teScrollTop=function(){angular.element("body").scrollTop(0)}},template:'<div ng-click="teScrollTop()"><span class="glyphicon glyphicon-arrow-up"></span></div>'}})}(),function(){angular.module("app.layout").directive("transferBuilder",["serverApi","funcFactory",function(t,e){return{restrict:"E",scope:{config:"=",transfersList:"="},link:function(a,r,n){function o(){a.newTransfer={date:new Date,amount:0,partner:{},partner_id:"",number:null,description:""},a.dateDrop.maxDate=a.newTransfer.date}var i=r.find(".modal");a.partnerSelectConfig={dataMethod:t.getPartners},a.data={partnersList:[]},a.config.showForm=function(){o(),i.modal("show")},a.dateDrop={opened:!1,open:function(){a.dateDrop.opened=!0}},o(),a.createTransfer=function(){var t=a.newTransfer;t.partner&&(t.partner_id=t.partner.id),delete t.partner;var r=function(t){a.transfersList.unshift(t),e.showNotification(("IncomingTransfer"===t.type?"Входящий":"Исходящий")+" платеж успешно добавлен",t.number,!0)};a.config.createMethod(t,function(t){t.data.errors?e.showNotification("Не удалось создать платеж",t.data.errors):(angular.isArray(t.data)?t.data.map(function(t){r(t)}):r(t.data),i.modal("hide"),o())},angular.noop)}},templateUrl:"/assets/admin/app/layout/partials/transfer-builder.tplt.html"}}])}(),function(){angular.module("app.layout").directive("uiSelectInfinity",["$q","$compile","$timeout",function(t,e,a){return{restrict:"A",link:function(r,n,o){function i(){!d&&m.maxHeight-l.scrollTop()<m.scrollDistance&&(c++,s(!0))}function s(e){d=!0,r.searchStatus=e?"result":"inload",p=t.defer(),m.dataMethod(c,u,{timeout:p.promise},function(t){d=0==t.data.length,r.$select.items=r.$select.items.concat(t.data),c==m.startPage&&0==t.data.length?r.searchStatus="noresult":r.searchStatus="result"})}var c,l,d,u,p,f,m={startFrom:2,startPage:1,scrollDistance:50,maxHeight:200,delay:500,dataMethod:angular.noop,searchStatusTmpl:'<div class="ui-select-status"><span ng-if="searchStatus == \'before\'">Введите еще хотя бы {{config.startFrom}} символа</span><span ng-if="searchStatus == \'noresult\'">Поиск не дал результатов</span><span ng-if="searchStatus == \'inload\'">Поиск...</span></div>'},g=t.defer(),v=r.$watch(o.uiSelectInfinity,function(t){t&&(m=r.config=angular.extend(m,t),n.find(".ui-select-choices").append(e(m.searchStatusTmpl)(r)),r.searchStatus="before",v())});r.$watch("$select.search",function(t){void 0!==t&&(d&&p.resolve(),a.cancel(f),c=m.startPage,d=!1,u=t,r.$select.items=[],""!==t&&t.length>=m.startFrom?f=a(s,m.delay):r.searchStatus="before")}),g.promise.then(function(){l=n.find(".ui-select-choices-content").scroll(i)}),r.$watch("$select.open",function(t){t&&(g.resolve(),a(function(){r.$select.searchInput[0].focus()},100))}),r.$on("$destroy",function(){l&&l.off("scroll")})}}}])}(),function(){"use strict";angular.module("app.layout").directive("jarvisWidget",["$rootScope",function(t){return console.log("created widget directive"),{restrict:"A",compile:function(e,a){e.data("widget-color")&&e.addClass("jarviswidget-color-"+e.data("widget-color")),e.find(".widget-body").prepend('<div class="jarviswidget-editbox"><input class="form-control" type="text"></div>'),e.addClass("jarviswidget"),t.$emit("jarvisWidgetAdded",e)}}}])}(),function(){"use strict";angular.module("app.layout").directive("widgetGrid",["$rootScope","$compile","$q","$state","$timeout",function(t,e,a,r,n){var o,i,s,c={grid:"article",widgets:".jarviswidget",localStorage:!0,deleteSettingsKey:"#deletesettingskey-options",settingsKeyLabel:"Reset settings?",deletePositionKey:"#deletepositionkey-options",positionKeyLabel:"Reset position?",sortable:!0,buttonsHidden:!1,toggleButton:!0,toggleClass:"fa fa-minus | fa fa-plus",toggleSpeed:200,onToggle:function(){},deleteButton:!0,deleteMsg:"Warning: This action cannot be undone!",deleteClass:"fa fa-times",deleteSpeed:200,onDelete:function(){},editButton:!0,editPlaceholder:".jarviswidget-editbox",editClass:"fa fa-cog | fa fa-save",editSpeed:200,onEdit:function(){},colorButton:!0,fullscreenButton:!0,fullscreenClass:"fa fa-expand | fa fa-compress",fullscreenDiff:3,onFullscreen:function(){},customButton:!1,customClass:"folder-10 | next-10",customStart:function(){alert("Hello you, this is a custom button...")},customEnd:function(){alert("bye, till next time...")},buttonOrder:"%refresh% %custom% %edit% %toggle% %fullscreen% %delete%",opacity:1,dragHandle:"> header",placeholderClass:"jarviswidget-placeholder",indicator:!0,indicatorTime:600,ajax:!0,timestampPlaceholder:".jarviswidget-timestamp",timestampFormat:"Last update: %m%/%d%/%y% %h%:%i%:%s%",refreshButton:!0,refreshButtonClass:"fa fa-refresh",labelError:"Sorry but there was a error:",labelUpdated:"Last Update:",labelRefresh:"Refresh",labelDelete:"Delete widget:",afterLoad:function(){},rtl:!1,onChange:function(){},onSave:function(){},ajaxnav:!0},l=[],d=!1,u=function(t,e){d?d||(d=!0,n(function(){d=!1,u(t,e)},200)):_.intersection(e,l).length!=e.length&&(l=_.union(e,l),t.data("jarvisWidgets")&&t.data("jarvisWidgets").destroy(),t.jarvisWidgets(c))},p=function(t,e){t.data("jarvisWidgets")&&t.data("jarvisWidgets").destroy(),l=_.xor(l,e)};return{restrict:"A",compile:function(e){e.removeAttr("widget-grid data-widget-grid");var a=[];i=t.$on("$viewContentLoaded",function(t,r){n(function(){u(e,a)},100)}),s=t.$on("$stateChangeStart",function(t,r,n,c,l){o(),i(),s(),p(e,a)}),o=t.$on("jarvisWidgetAdded",function(t,r){-1==a.indexOf(r.attr("id"))&&(a.push(r.attr("id")),n(function(){u(e,a)},100))})}}}])}(),function(){"use strict";angular.module("app.articles").controller("ArticlesCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.pages.view",{id:t.id||t._id})}function s(t){e.go("app.pages.view.edit",{id:t.id||t._id})}function c(t){$.SmartMessageBox({title:"Удалить страницу?",content:"Вы действительно хотите удалить страницу "+t.title,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deletePage(t.id,function(e){e.data.errors?o.showNotification("Не удалось удалить страницу "+t.title,e.data.errors):(l.data.pagesList.splice(t.index,1),o.showNotification("Страница "+t.title+" успешно удалена.","",!0))})})}var l=t;l.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:c}]},l.data={articlesList:[],searchQuery:a.q}}])}(),function(){angular.module("login").controller("loginCtrl",["$scope","serverApi","$state","funcFactory",function(t,e,a,r){t.loginData={user:{email:"",password:""}},t.restoreData={user:{email:""}},t.forgotPass=!1,t.authError=!1,t.passRestored=!1,t.flipForm=function(e){t.forgotPass=e,t.authError=!1,t.passRestored=!1},t.restorePass=function(){e.resetPassword(t.restoreData,function(e){t.authError=!1,t.passRestored=!0},function(t){r.showNotification("Не удалось восстановить пароль","Пользователь не существует!")})},t.submit=function(){t.authError=!1,e.signIn(t.loginData,function(t){window.authorized=t.data.id,a.go("app.dashboard")},function(e){t.authError=!0})}}])}(),function(){"use strict";angular.module("app.catalogues").controller("CataloguesCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.catalogues.view",{id:t.id||t._id})}function s(t){e.go("app.catalogues.view.edit",{id:t.id||t._id})}function c(t){$.SmartMessageBox({title:"Удалить категорию?",content:"Вы действительно хотите удалить категорию "+t.name,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deleteCatalogue(t.id,function(e){e.data.errors?o.showNotification("Не удалось удалить категорию "+t.name,e.data.errors):(l.data.cataloguesList.splice(t.index,1),o.showNotification("Категория "+t.name+" успешно удалена.","",!0))})})}var l=t;l.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:c}]},l.data={cataloguesList:[],searchQuery:a.q}}])}(),function(){angular.module("app.catalogues").controller("EditCatalogueCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(){e.go("app.catalogues.view",a)}function s(){e.go("app.catalogues",a)}var c=t;c.data={catalogue:{}},c.visual={navButtsOptions:[{type:"back",callback:s},{type:"show",callback:i}],roles:{}},c.tinymceOptions=o.getTinymceOptions(),r.getCatalogueDetails(a.id,function(t){var e=c.data.catalogue=t.data;c.visual.roles={can_edit:e.can_edit,can_destroy:e.can_destroy}}),c.saveCatalogue=function(){var t=c.data.catalogue,e={catalogue:{name:t.name,description:t.description}};r.updateCatalogue(t.id,e,function(e){200!=e.status||e.data.errors?o.showNotification("Неудача","Не удалось отредактировать категорию "+t.name,!0):o.showNotification("Успешно","Категория "+t.name+" успешно отредактирована.",!0)})}}])}(),function(){"use strict";angular.module("app.catalogues").controller("ViewCatalogueCtrl",["$scope","$state","$stateParams","serverApi","$sce",function(t,e,a,r,n){function o(){e.go("app.catalogues",{})}function i(){e.go("app.catalogues.view.edit",a)}var s=t;s.catalogue={},s.visual={navButtsOptions:[{type:"back",callback:o},{type:"edit",callback:i}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50}},r.getCatalogueDetails(a.id,function(t){console.log(t.data),s.catalogue=t.data,s.catalogue.description=n.trustAsHtml(t.data.description)})}])}(),function(){"use strict";angular.module("app.contacts").controller("ContactsCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(t){e.go("app.contacts.view",{id:t.id||t._id})}function i(t){e.go("app.contacts.view.edit",{id:t.id||t._id})}function s(){c(),$("#createNewContactModal").modal("show")}function c(){l.newContact={first_name:"",last_name:"",email:"",partner_id:""}}var l=t;l.visual={navButtsOptions:[{type:"new",callback:s}],navTableButts:[{type:"view",callback:o},{type:"table_edit",callback:i},{type:"remove"}],titles:[window.gon.index.Contact.indexTitle]},l.data={contactsList:[],searchQuery:a.q,partnersList:[]},l.partnerSelectConfig={dataMethod:r.getPartners},l.createContact=function(){console.log(l.newContact);var t=l.newContact;t.partner&&(t.partner_id=t.partner.id),delete t.partner,r.createContact(t,function(t){t.data.errors?n.showNotification("Не удалось создать новый контакт",t.data.errors):(l.data.contactsList.unshift(t.data),n.showNotification("Успешно","Контакт "+t.data.email+" добавлен в список",!0))})}}])}(),function(){angular.module("app.contacts").controller("EditContactCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(){e.go("app.contacts.view",a)}function s(){e.go("app.contacts",a)}var c=t;c.data={contact:{},partnersList:[],newPartner:{}},c.visual={navButtsOptions:[{type:"back",callback:s},{type:"show",callback:i}],roles:{},canChangePartner:!0,titles:["Редактировать "+window.gon.index.Contact.objectTitle.toLowerCase()]},r.getContactDetails(a.id,function(t){var e=c.data.contact=t.data;o.setPageTitle("Контакт "+e.email)}),c.partnerSelectConfig={dataMethod:r.getPartners},c.saveContact=function(){var t=c.data.contact,e={contact:{first_name:t.first_name,last_name:t.last_name,do_not_email:t.do_not_email,partner_id:t.partner.id}};r.updateContact(t.id,e,function(e){e.data.errors?o.showNotification("Не удалось отредактировать контакт "+t.email,e.data.errors):o.showNotification("Успешно","Контакт "+t.email+" успешно отредактирован.",!0)})}}])}(),function(){"use strict";angular.module("app.contacts").controller("ViewContactCtrl",["$scope","$state","$stateParams","serverApi",function(t,e,a,r){function n(){e.go("app.contacts",{})}function o(){e.go("app.contacts.view.edit",{})}var i=t;i.contact={},i.visual={navButtsOptions:[{type:"back",callback:n},{type:"edit",callback:o}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},titles:window.gon.index.Contact.objectTitle+": "},r.getContactDetails(a.id,function(t){console.log(t.data),i.contact=t.data})}])}(),function(){"use strict";angular.module("app.customer_orders").controller("CustomerOrdersCtrl",["$scope","$state","$stateParams","serverApi","CanCan","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.customer_orders.view",{id:t.data.id||t.data._id})}function s(t){e.go("app.customer_orders.view.edit",{id:t.data.id||t.data._id})}function c(){d.newOrderData.date=new Date,$("#createNewOrderModal").modal("show")}function l(t){$.SmartMessageBox({title:"Удалить заказ?",content:"Вы действительно хотите удалить заказ "+t.data.number,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deleteCustomerOrder(t.data.id,function(e){e.data.errors?o.showNotification("Не удалось удалить заказ "+t.data.number,e.data.errors):(d.data.ordersList.splice(t.index,1),o.showNotification("Заказ "+t.data.number+" успешно удален.","",!0))})})}var d=t;d.visual={navButtsOptions:[{type:"new",callback:c}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:l}],canAddPartner:n.can("see_multiple","Partner"),titles:[window.gon.index.CustomerOrder.indexTitle]},d.data={ordersList:[],partnersList:[],searchQuery:a.q},d.partnerSelectConfig={dataMethod:r.getPartners},d.addNewOrder=function(){d.newOrderData.partner&&d.newOrderData.partner&&(d.newOrderData.partner_id=d.newOrderData.partner.id),delete d.newOrderData.date,delete d.newOrderData.partner,r.createCustomerOrder(d.newOrderData,function(t){t.data.errors?o.showNotification("Не удалось создать заказ",t.data.errors):(d.data.ordersList.unshift(t.data),o.showNotification("Заказ успешно добавлен","",!0),d.clearCreateOrder(),e.go("app.customer_orders.view.edit",{id:t.data.id}))})},d.clearCreateOrder=function(){d.newOrderData={date:null,title:"",description:"",partner_id:"",request_original:""}},d.clearCreateOrder()}])}(),function(){angular.module("app.customer_orders").controller("EditCustomerOrder",["$scope","$state","$stateParams","serverApi","$filter","funcFactory","customerOrdersNotifications",function(t,e,a,r,n,o,i){function s(t,e,a){var n=function(){var e=t.data;r.updateCustomerOrderProduct(h.data.order.id,e.id,{quantity:e.quantity,discount:e.discount},function(a){if(a.data.errors)o.showNotification("Не удалось обновить данные продукта",a.data.errors);else{var r=h.data.order.customer_order_contents[t.index];h.data.order.customer_order_contents[t.index]=angular.extend(r,a.data),o.showNotification("Успешно обновлены данные продукта",e.product.name,!0)}})};h.visual.roles.can_edit&&(a?13==a.keyCode&&n():n())}function c(t){r.removeCustomerOrderProduct(h.data.order.id,t.data.id,function(e){e.data.errors?o.showNotification("Не удалось удалить продукт",e.data.errors):(h.data.order.customer_order_contents.splice(t.index,1),o.showNotification("Продукт удален:",t.data.product.name,!0))})}function l(){e.go("app.customer_orders.view",a)}function d(){e.go("app.customer_orders",a)}function u(){e.go("app.customer_orders.view.logs",{})}function p(){r.sendCustomerOrderInvoice(a.id,function(t){200!=t.status||t.data.errors?200==t.status&&t.data.errors?o.showNotification("Неудача",t.data.errors,!0):o.showNotification("Неудача","Ошибка при попытке отправить заказ.",!0):o.showNotification("Успешно","Заказ успешно отправлен.",!0)})}function f(){h.visual.showFileModal()}function m(t,e){var n={customer_order:{event:e.event}};r.updateStatusCustomerOrder(a.id,n,function(t){200!=t.status||t.data.errors?o.showNotification("Не удалось "+e.name.toLowerCase()+" заказ",t.data.errors):(o.showNotification("Успешно","Удалось "+e.name.toLowerCase()+" заказ",!0),h.data.order=t.data)})}function g(){console.log("Started"),r.recalculateCustomerOrder(a.id,function(t){200!=t.status||t.data.errors?o.showNotification("Неудача","Ошибка при попытке отправить заказ.",!0):(o.showNotification("Успешно","Заказ успешно отправлен.",!0),h.data.order=t.data)})}function v(t,e){var a=$(this),n=angular.element(e.item).scope().$index,i=e.item.index(),s={customer_order:{command:"переместить_строку "+(n+1)+"_на_"+(i+1)}};r.updateCommandCustomerOrder(h.data.order.id,s,function(t){200==t.status?h.data.order.customer_order_contents.swapItemByindex(n,i):(o.showNotification("Не удалось переместить сторку",t.data.errors),a.sortable("cancel"))},function(){a.sortable("cancel")})}var h=t;h.data={order:{},partnersList:[],productsList:[],total:0},h.productForAppend={},h.visual={navButtsOptions:[{type:"back",callback:d},{type:"show",callback:l},{type:"files",callback:f},{type:"send_email",callback:p},{type:"recalculate",callback:g},{type:"logs",callback:u},{type:"confirm_order",callback:m}],navTableButts:[{type:"table_edit",disabled:!1,callback:s},{type:"remove",disabled:!1,callback:c}],roles:{},showFileModal:angular.noop,titles:[window.gon.index.CustomerOrder.indexTitle,"Редактировать "+window.gon.index.CustomerOrder.objectTitle.toLowerCase()+": #"],sortOpts:{update:v,items:"> .order-items"}},h.pSelectConfig={startPage:0,dataMethod:r.getSearch},h.partnerSelectConfig={dataMethod:r.getPartners},r.getCustomerOrderDetails(a.id,function(t){var e=h.data.order=t.data;h.data.order.date=n("date")(e.date,"dd.MM.yyyy HH:mm"),h.visual.roles={can_edit:e.can_edit,can_destroy:e.can_edit,can_confirm:e.can_confirm},o.setPageTitle("Заказ "+h.data.order.number),h.fileModalOptions={url:"/api/customer_orders/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"customer_orders",id:e.id},i.subscribe({channel:"CustomerOrdersChannel",customer_order_id:a.id},h.data.order.customer_order_contents)}),h.saveOrderInfo=function(){var t=h.data.order,e={customer_order:{title:t.title,description:t.description,partner_id:t.partner.id}};r.updateCustomerOrder(t.id,e,function(e){200!=e.status||e.data.errors?o.showNotification("Неудача","Не удалось отредактировать заказ "+t.number,!0):o.showNotification("Успешно","Заказ "+t.number+" успешно отредактирован.",!0)})},h.selectProductForAppend=function(t){h.productForAppend=t,h.productForAppend.id=t.id||t._id,h.productForAppend.quantity=0,
t.hasOwnProperty("discount")||(h.productForAppend.discount=0)},h.appendProduct=function(t){var e=function(){var t=h.productForAppend,e=angular.extend(t,{product:{name:t.name,id:t.id}}),a={product_id:t.id,quantity:t.quantity,discount:t.discount};h.productForAppend={},h.data.selectedProduct=null,r.addCustomerOrderProduct(h.data.order.id,a,function(a){a.data.errors?o.showNotification("Не удалось добавить продукт",a.data.errors):(h.data.order.customer_order_contents.push(angular.extend(e,a.data)),o.showNotification("Успешно добавлен продукт",t.name,!0))})};t?13==t.keyCode&&e():e()},h.updateProductOfOrder=s,h.$watch("data.order.customer_order_contents",function(t){if(t){var e=0;t.map(function(t){e+=n("price_net")(t,t.quantity)}),h.data.total=e}},!0),h.focusOnProduct=function(){window.setTimeout(function(){angular.element("#append_product_quantity")[0].focus()},0)}}])}(),function(){"use strict";angular.module("app.customer_orders").controller("LogsCustomerOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(){e.go("app.customer_orders.view",a)}function i(){e.go("app.customer_orders",{})}function s(){r.sendCustomerOrderInvoice(a.id,function(t){200!=t.status||t.data.errors?200==t.status&&t.data.errors?n.showNotification("Неудача",t.data.errors,!0):n.showNotification("Неудача","Ошибка при попытке отправить заказ.",!0):n.showNotification("Успешно","Заказ успешно отправлен.",!0)})}var c=t;c.logs={},c.visual={navButtsOptions:[{type:"back",callback:i},{type:"files"},{type:"send_email",callback:s},{type:"recalculate"},{type:"confirm_order"},{type:"show",callback:o}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50}},r.getCustomerOrderLogs(a.id,function(t){c.logs=t.data})}])}(),function(){"use strict";angular.module("app.customer_orders").controller("ViewCustomerOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory","$filter","customerOrdersNotifications",function(t,e,a,r,n,o,i){function s(t){g.fileModalOptions={url:"/api/customer_orders/"+t.id+"/documents",files:t.documents,r_delete:r.deleteFile,view:"customer_orders",id:t.id},i.subscribe({channel:"CustomerOrdersChannel",customer_order_id:a.id},g.order.customer_order_contents)}function c(t){var e,a,r,n;for(e=0,a=0,r=0,n=t.incoming_transfers.length;n>r;r++){var o=t.incoming_transfers[r];e+=o.linked_total,a+=o.amount}for(g.total_paid_linked=e,g.total_paid=a,e=0,a=0,r=0,n=t.dispatch_orders.length;n>r;r++){var i=t.dispatch_orders[r];e+=i.linked_total,a+=i.amount}g.total_dispatched_linked=e,g.total_dispatched=a}function l(){e.go("app.customer_orders",{})}function d(){e.go("app.customer_orders.view.logs",{})}function u(){e.go("app.customer_orders.view.edit",{})}function p(){g.visual.showFileModal()}function f(){r.sendCustomerOrderInvoice(a.id,function(t){200!=t.status||t.data.errors?200==t.status&&t.data.errors?n.showNotification("Неудача",t.data.errors,!0):n.showNotification("Неудача","Ошибка при попытке отправить заказ.",!0):n.showNotification("Успешно","Заказ успешно отправлен.",!0)})}function m(t,e){var o={customer_order:{event:e.event}};r.updateStatusCustomerOrder(a.id,o,function(t){200!=t.status||t.data.errors?n.showNotification("Не удалось "+e.name.toLowerCase()+" заказ",t.data.errors):(n.showNotification("Успешно","Удалось "+e.name.toLowerCase()+" заказ",!0),g.order=t.data)})}var g=t;g.order={},g.total=0,g.visual={navButtsOptions:[{type:"back",callback:l},{type:"edit",callback:u},{type:"files",callback:p},{type:"send_email",callback:f},{type:"recalculate"},{type:"logs",callback:d},{type:"confirm_order",callback:m}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,titles:window.gon.index.CustomerOrder.objectTitle+": №"},g.amontPercent=0,g.dispatchedPercent=0,r.getCustomerOrderDetails(a.id,function(t){console.log(t.data);var e=g.order=t.data;n.setPageTitle("Заказ "+g.order.number),g.amontPercent=n.getPercent(e.paid_amount,e.total),g.dispatchedPercent=n.getPercent(e.dispatched_amount,e.total),c(e),s(e)}),g.$watch("order.customer_order_contents",function(t){if(t){var e=0;t.map(function(t){e+=o("price_net")(t,t.quantity)}),g.total=e}},!0)}])}(),function(){"use strict";angular.module("app.dashboard").controller("DashboardCtrl",["$scope","serverApi",function(t,e){t.data={customerOrders:[],dispatchOrders:[]},e.getCustomerOrders(1,"",{},function(e){console.log("customer_orders",e),t.data.customerOrders=e.data.slice(0,10)}),e.getDispatchOrders(1,"",{},function(e){t.data.dispatchOrders=e.data.slice(0,10)})}])}(),function(){var t=angular.module("app.incoming_transfers");t.controller("EditIncomingTransferCtrl",["$scope","$state","$stateParams","serverApi","funcFactory","$q",function(t,e,a,r,n,o){function i(t){var e=t.data;r.removeIncomingTransferOrder(d.transfer.id,e.id,function(a){var r=e.hasOwnProperty("outgoing_transfer"),o=r?"Платеж "+e.outgoing_transfer.incoming_code:"Заказ "+e.customer_order.number;a.data.errors?n.showNotification("Неудалось удалить "+o,a.data.errors):(d.transfer.remaining_amount=a.data.money_transfer.remaining_amount,d.transfer.money_to_orders.splice(t.index,1),n.showNotification(o+" успешно удален","",!0))})}function s(){e.go("app.incoming_transfers",a)}function c(){e.go("app.incoming_transfers.view",a)}function l(){d.visual.showFileModal()}var d=t;d.transfer={},d.data={partnersList:[],ordersList:[],orderForAppend:{amount:0}},d.visual={navButtsOptions:[{type:"back",callback:s},{type:"show",callback:c},{type:"files",callback:l},{type:"send_email"},{type:"logs"}],navTableButts:[{type:"remove",callback:i}],roles:{can_destroy:!0},showFileModal:angular.noop,titles:["Редактировать "+window.gon.index.IncomingTransfer.objectTitle.toLowerCase()]},d.partnerSelectConfig={dataMethod:r.getPartners},d.orderSelectConf={dataMethod:function(t,e,a,n){var i=o.defer(),s=o.defer(),c=[],l=function(t){return 200==t.status?t.data:[]},d=[o.defer(),o.defer()];r.getCustomerOrders(t,e,{timeout:i.promise},function(t){d[0].resolve(l(t))}),r.getOutgoingTransfers(t,e,{timeout:s.promise},function(t){d[1].resolve(l(t))}),a.timeout.then(function(){i.resolve(),s.resolve()}),o.all(d.map(function(t){return t.promise})).then(function(t){c=t[0].concat(t[1]),n({data:c})})}},r.getIncomingTransferDetails(a.id,function(t){console.log(t.data);var e=d.transfer=t.data;d.fileModalOptions={url:"/api/incoming_transfers/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"incoming_transfers",id:e.id}}),d.appendOrder=function(t){var e=d.data.orderForAppend,a=function(){d.data.orderForAppend={};var t={amount:e.amount},a=!1;"OutgoingTransfer"===e.type?(a=!0,t.outgoing_transfer_id=e.id):t.customer_order_id=e.id,r.appendIncomingTransferOrder(d.transfer.id,t,function(t){var r=a?"Платеж "+e.number:"Заказ "+e.number;t.data.errors?n.showNotification("Неудалось прикрепить "+r,t.data.errors):(d.transfer.remaining_amount=t.data.money_transfer.remaining_amount,d.transfer.money_to_orders.push(t.data),n.showNotification("Успешно",r+" успешно добавлен",!0))})};t?13==t.keyCode&&a():a()}}]),t.filter("f_incomingT",function(){return function(t){return t.hasOwnProperty("incoming_code")?'<i class="fa fa-rub" title="Платеж"></i> '+t.incoming_code:'<i class="fa fa-book" title="Заказ"></i> '+t.number}})}(),function(){"use strict";angular.module("app.incoming_transfers").controller("IncomingTransfersCtrl",["$scope","$state","$stateParams","serverApi","$filter","CanCan","funcFactory",function(t,e,a,r,n,o,i){function s(t){e.go("app.incoming_transfers.view",{id:t.data.id||t.data._id})}function c(t){e.go("app.incoming_transfers.view.edit",{id:t.data.id||t.data._id})}function l(){u.newTransferConfig.showForm()}function d(t){$.SmartMessageBox({title:"Удалить входящий платёж?",content:"Вы действительно хотите удалить входящий платёж "+t.data.number,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deleteIncomingTransfer(t.data.id,function(e){e.data.errors?i.showNotification("Не удалось удалить платеж "+t.data.number,e.data.errors):(u.data.incomingTransfersList.splice(t.index,1),i.showNotification("Платеж "+t.data.number+" успешно удален.","",!0))})})}var u=t;u.visual={navButtsOptions:[{type:"new",callback:l}],navTableButts:[{type:"view",callback:s},{type:"table_edit",callback:c},{type:"remove",callback:d}],role:{can_edit:o.can("edit","IncomingTransfer"),can_destroy:o.can("destroy","IncomingTransfer")},titles:[window.gon.index.IncomingTransfer.indexTitle]},u.data={incomingTransfersList:[],searchQuery:a.q},u.newTransferConfig={createMethod:r.createIncomingTransfer,showForm:angular.noop}}])}(),function(){"use strict";angular.module("app.incoming_transfers").controller("ViewIncomingTransferCtrl",["$scope","$state","$stateParams","serverApi",function(t,e,a,r){function n(){e.go("app.incoming_transfers",{})}function o(){c.visual.showFileModal()}function i(){e.go("app.incoming_transfers.view.edit",a)}function s(t){t.data.hasOwnProperty("customer_order")&&e.go("app.customer_orders.view",{id:t.data.customer_order.id}),t.data.hasOwnProperty("incoming_transfer")&&e.go("app.incoming_transfer.view",{id:t.data.incoming_transfer.id})}var c=t;c.incomingTransfer={},c.visual={navButtsOptions:[{type:"back",callback:n},{type:"edit",callback:i},{type:"files",callback:o}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,navTableButts:[{type:"view",callback:s}],titles:window.gon.index.IncomingTransfer.objectTitle+": # "},r.getIncomingTransferDetails(a.id,function(t){console.log(t.data);var e=c.incomingTransfer=t.data;c.fileModalOptions={url:"/api/incoming_transfers/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"incoming_transfers",id:e.id}})}])}(),function(){"use strict";angular.module("app.dispatch_orders").controller("DispatchOrdersCtrl",["$scope","$state","$stateParams","serverApi",function(t,e,a,r){function n(t){e.go("app.dispatch_orders.view",{id:t})}var o=t;o.visual={navButtsOptions:[],navTableButts:[{type:"view",callback:n},{type:"table_edit"},{type:"remove"}],titles:[window.gon.index.DispatchOrder.indexTitle]},o.data={ordersList:[],searchQuery:a.q}}])}(),function(){"use strict";angular.module("app.dispatch_orders").controller("ViewDispatchOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(){e.go("app.dispatch_orders",{})}function i(){var t=location.href.replace(u,"")+".pdf";window.open(t,"_blank")}function s(){var t=location.href.replace(u,"")+"/label.pdf";window.open(t,"_blank")}function c(){var t=location.href.replace(u,"")+"/packing_list.pdf";window.open(t,"_blank")}function l(){p.visual.showFileModal()}function d(t,e){var o={dispatch_order:{event:e.event}};r.updateStatusDispatchOrder(a.id,o,function(t){200!=t.status||t.data.errors?n.showNotification("Не удалось "+e.name.toLowerCase()+" заказ",t.data.errors):(n.showNotification("Успешно","Удалось "+e.name.toLowerCase()+" заказ",!0),p.dispatchOrder=t.data)})}var u=/\/?#/,p=t;p.dispatchOrder={},p.visual={navButtsOptions:[{type:"back",callback:o},{type:"files",callback:l},{type:"upd_form_pdf",callback:i},{type:"label_pdf",callback:s},{type:"packing_list_pdf",callback:c},{type:"confirm_order",callback:d}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,titles:window.gon.index.DispatchOrder.objectTitle+": #"},p.amontPercent=0,p.dispatchedPercent=0,r.getDispatchOrderDetails(a.id,function(t){console.log(t.data);var e=p.dispatchOrder=t.data;p.amontPercent=n.getPercent(e.paid_amount,e.total),p.dispatchedPercent=n.getPercent(e.dispatched_amount,e.total),p.fileModalOptions={url:"/api/dispatch_orders/"+e.id+"/documents",r_get:r.getDocuments,r_delete:r.deleteFile,view:"dispatch_orders",id:e.id}}),p.saveChosenPerson=function(){var t={dispatch_order:{person_id:p.dispatchOrder.chosenPersonId}};r.updateDispatchOrder(p.dispatchOrder.id,t,function(t){t.data.errors?n.showNotification("Ошибка при выборе человека",t.data.errors):(p.dispatchOrder=t.data,n.showNotification("Успешно","Человек выбран.",!0))})}}])}(),function(){angular.module("app.manufacturers").controller("EditManufacturerCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(){e.go("app.manufacturers.view",a)}function s(){e.go("app.manufacturers",a)}var c=t;c.data={manufacturer:{}},c.visual={navButtsOptions:[{type:"back",callback:s},{type:"show",callback:i}],roles:{}},c.tinymceOptions=o.getTinymceOptions(),r.getManufacturerDetails(a.id,function(t){var e=c.data.manufacturer=t.data;c.visual.roles={can_edit:e.can_edit,can_destroy:e.can_destroy}}),c.saveManufacturer=function(){var t=c.data.manufacturer,e={manufacturer:{name:t.name,description:t.description}};r.updateManufacturer(t.id,e,function(e){200!=e.status||e.data.errors?o.showNotification("Неудача","Не удалось отредактировать производителя "+t.name,!0):o.showNotification("Успешно","Производитель "+t.name+" успешно отредактирован.",!0)})}}])}(),function(){"use strict";angular.module("app.manufacturers").controller("ManufacturersCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(t){e.go("app.manufacturers.view",{id:t.data.id||t.data._id})}function i(t){e.go("app.manufacturers.view.edit",{id:t.data.id||t.data._id})}function s(t){var e=t.data;$.SmartMessageBox({title:"Удалить производителя?",content:"Вы действительно хотите удалить производителя "+e.name,buttons:"[Нет][Да]"},function(a){"Да"===a&&r.deleteManufacturer(e.id,function(a){a.data.errors?n.showNotification("Не удалось удалить производителя "+e.name,a.data.errors):(c.data.manufacturersList.splice(t.index,1),n.showNotification("Производитель "+e.name+" успешно удален.","",!0))})})}var c=t;c.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:o},{type:"table_edit",callback:i},{type:"remove",callback:s}]},c.data={manufacturersList:[],searchQuery:a.q}}])}(),function(){"use strict";angular.module("app.manufacturers").controller("ViewManufacturerCtrl",["$scope","$state","$stateParams","serverApi","$sce",function(t,e,a,r,n){function o(){e.go("app.manufacturers",{})}function i(){e.go("app.manufacturers.view.edit",a)}var s=t;s.manufacturer={},s.visual={navButtsOptions:[{type:"back",callback:o},{type:"edit",callback:i}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50}},r.getManufacturerDetails(a.id,function(t){console.log(t.data),s.manufacturer=t.data,s.manufacturer.description=n.trustAsHtml(t.data.description)})}])}(),function(){"use strict";angular.module("app.news").controller("NewsCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.news.view",{id:t.id||t._id})}function s(t){e.go("app.news.view.edit",{id:t.id||t._id})}function c(t){$.SmartMessageBox({title:"Удалить страницу?",content:"Вы действительно хотите удалить страницу "+t.title,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deletePage(t.id,function(e){e.data.errors?o.showNotification("Не удалось удалить страницу "+t.title,e.data.errors):(l.data.pagesList.splice(t.index,1),o.showNotification("Страница "+t.title+" успешно удалена.","",!0))})})}var l=t;l.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:c}]},l.data={newsList:[],searchQuery:a.q}}])}(),function(){angular.module("app.outgoing_transfers").controller("EditOutgoingTransferCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(t){var e=t.data;r.removeOutgoingTransferOrder(l.transfer.id,e.id,function(a){a.data.errors?n.showNotification("Неудалось удалить заказ "+e.supplier_order.number,a.data.errors):(l.transfer.remaining_amount=a.data.outgoing_money_distributions.remaining_amount,l.transfer.outgoing_money_distributions.splice(t.index,1),n.showNotification("Заказ "+e.supplier_order.number+" успешно удален","",!0))})}function i(){e.go("app.outgoing_transfers",a)}function s(){e.go("app.outgoing_transfers.view",a)}function c(){l.visual.showFileModal()}var l=t;l.transfer={},l.data={partnersList:[],ordersList:[],orderForAppend:{amount:0}},l.visual={navButtsOptions:[{type:"back",callback:i},{type:"show",callback:s},{type:"files",callback:c},{type:"send_email"},{type:"logs"}],navTableButts:[{type:"remove",callback:o}],roles:{can_destroy:!0},showFileModal:angular.noop,titles:["Редактировать "+window.gon.index.OutgoingTransfer.objectTitle.toLowerCase()]},l.partnerSelectConfig={dataMethod:r.getPartners},l.orderSelectConf={dataMethod:r.getSupplierOrders},r.getOutgoingTransferDetails(a.id,function(t){console.log(t.data);var e=l.transfer=t.data;l.fileModalOptions={url:"/api/outgoing_transfers/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"outgoing_transfers",id:e.id}}),l.appendOrder=function(t){var e=l.data.orderForAppend,a=function(){l.data.orderForAppend={},r.appendOutgoingTransferOrder(l.transfer.id,{outgoing_transfer_id:l.transfer.id,amount:e.amount,supplier_order_id:e.id},function(t){t.data.errors?n.showNotification("Неудалось прикрепить заказ "+e.number,t.data.errors):(console.log(t.data),l.transfer.remaining_amount=t.data.outgoing_money_distributions.remaining_amount,l.transfer.outgoing_money_distributions.push(angular.extend({amount:e.amount,supplier_order:{number:e.number}},t.data)),n.showNotification("Успешно","Заказ "+e.number+" успешно добавлен",!0))})};t?13==t.keyCode&&a():a()}}])}(),function(){"use strict";angular.module("app.outgoing_transfers").controller("OutgoingTransfersCtrl",["$scope","$state","$stateParams","serverApi","CanCan","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.outgoing_transfers.view",{id:t.data.id||t.data._id})}function s(t){e.go("app.outgoing_transfers.view.edit",{id:t.data.id||t.data._id})}function c(){d.newTransferConfig.showForm()}function l(t){$.SmartMessageBox({title:"Удалить исходящий платёж?",content:"Вы действительно хотите удалить исходящий платёж "+t.data.number,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deleteOutgoingTransfer(t.data.id,function(e){e.data.errors?o.showNotification("Не удалось удалить платеж "+t.data.number,e.data.errors):(d.data.outgoingTransfersList.splice(t.index,1),o.showNotification("Исходящий платёж","Вы удалили исходящий платёж "+t.data.number,!0))})})}var d=t;d.visual={navButtsOptions:[{type:"new",callback:c}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:l}],role:{can_edit:n.can("edit","OutgoingTransfer"),can_destroy:n.can("destroy","OutgoingTransfer")},titles:[window.gon.index.OutgoingTransfer.indexTitle]},d.data={outgoingTransfersList:[],searchQuery:a.q},d.newTransferConfig={createMethod:r.createOutgoingTransfer,showForm:angular.noop}}])}(),function(){"use strict";angular.module("app.outgoing_transfers").controller("ViewOutgoingTransferCtrl",["$scope","$state","$stateParams","serverApi",function(t,e,a,r){function n(){e.go("app.outgoing_transfers",{})}function o(){i.visual.showFileModal()}var i=t;i.outgoingTransfer={},i.visual={navButtsOptions:[{type:"back",callback:n},{type:"files",callback:o}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,titles:window.gon.index.OutgoingTransfer.objectTitle+" #"},r.getOutgoingTransferDetails(a.id,function(t){console.log(t.data);var e=i.outgoingTransfer=t.data;i.fileModalOptions={url:"/api/outgoing_transfers/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"outgoing_transfers",id:e.id}})}])}(),function(){"use strict";angular.module("app.pages").controller("PagesCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t){console.log("page",t),e.go("app.pages.view",{id:t.id||t._id})}function s(t){e.go("app.pages.view.edit",{id:t.id||t._id})}function c(t){$.SmartMessageBox({title:"Удалить страницу?",content:"Вы действительно хотите удалить страницу "+t.title,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deletePage(t.id,function(e){e.data.errors?o.showNotification("Не удалось удалить страницу "+t.title,e.data.errors):(l.data.pagesList.splice(t.index,1),o.showNotification("Страница "+t.title+" успешно удалена.","",!0))})})}var l=t;l.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove",callback:c}]},l.data={pagesList:[],searchQuery:a.q}}])}(),function(){"use strict";angular.module("app.pages").controller("ViewPageCtrl",["$scope","$state","$stateParams","serverApi","$sce",function(t,e,a,r,n){function o(){e.go("app.pages",{})}function i(){e.go("app.pages.view.edit",a)}var s=t;s.page={},s.visual={navButtsOptions:[{type:"back",callback:o},{type:"edit",callback:i}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50}},r.getPageDetails(a.id,function(t){s.page=t.data,s.page.content=n.trustAsHtml(t.data.content)})}])}(),function(){"use strict";angular.module("app.pdf_catalogues").controller("PdfCataloguesCtrl",["$scope","$state","$stateParams","serverApi","CanCan","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.pdf_catalogues.view",{id:t.data.id||t.data._id})}function s(t){var e=t.data.title;$.SmartMessageBox({title:"Удалить PDF каталог?",content:"Вы действительно хотите удалить PDF каталог "+e,buttons:"[Нет][Да]"},function(a){"Да"===a&&r.deletePdfCatalogue(t.data.id,function(a){a.data.errors?o.showNotification("Не удалось удалить PDF каталог",a.data.errors):(o.showNotification("Успешно","Каталог "+e+" удален!",!0),c.data.pdfCataloguesList.splice(t.index,1))})})}var c=t;c.visual={navButtsOptions:[{type:"new",callback:function(){}}],navTableButts:[{type:"view",callback:i},{type:"table_edit"},{type:"remove",callback:s}],role:{can_edit:n.can("edit","pdf_catalogues"),can_destroy:n.can("destroy","pdf_catalogues")}},c.data={pdfCataloguesList:[],searchQuery:a.q}}])}(),function(){"use strict";angular.module("app.pdf_catalogues").controller("ViewPdfCatalogueCtrl",["$scope","$state","$stateParams","serverApi",function(t,e,a,r){function n(){e.go("app.pdf_catalogues",{})}var o=t;o.pdfCatalogue={},o.visual={navButtsOptions:[{type:"back",callback:n}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50}},r.getPdfCatalogueDetails(a.id,function(t){o.pdfCatalogue=t.data})}])}(),function(){angular.module("app.partners").controller("EditPartnerCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(){e.go("app.partners.view",a)}function s(){e.go("app.partners",a)}var c=t;c.data={partner:{}},c.visual={navButtsOptions:[{type:"back",callback:s},{type:"show",callback:i}],roles:{},titles:"Редактирование:  "+window.gon.index.Partner.objectTitle.toLowerCase()},r.getPartnerDetails(a.id,function(t){console.log(t.data),c.data.partner=t.data}),c.savePartner=function(){var t=c.data.partner,e={partner:{name:t.name,legal_name:t.legal_name,delivery_address:t.delivery_address,legal_address:t.legal_address,phone:t.phone}};r.updatePartner(t.id,e,function(e){200!=e.status||e.data.errors?o.showNotification("Неудача","Не удалось отредактировать категорию "+t.name,!0):o.showNotification("Успешно","Категория "+t.name+" успешно отредактирована.",!0)})}}])}(),function(){"use strict";angular.module("app.partners").controller("PartnersCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t){e.go("app.partners.view",{id:t.id||t._id})}function s(t){e.go("app.partners.view.edit",{id:t.id||t._id})}function c(){$("#createPartnerModal").modal("show")}var l=t;l.visual={navButtsOptions:[{type:"new",callback:c}],navTableButts:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove"}],titles:[window.gon.index.Partner.indexTitle]},l.data={partnersList:[],searchQuery:a.q},l.newPartnerData={inn:"",name:"",delivery_address:"",phone:""},l.addNewPartner=function(){r.createPartner(l.newPartnerData,function(t){t.data.errors?o.showNotification("Не удалось создать партнёра",t.data.errors):(l.data.partnersList.unshift(t.data),o.showNotification("Партнёр успешно добавлен","",!0),l.clearNewPartnerData())})},l.clearNewPartnerData=function(){l.newPartnerData={inn:"",name:"",delivery_address:"",phone:""}},l.onAddFile=function(){}}])}(),function(){angular.module("app.partners").controller("ViewPartnerCtrl",["$scope","$state","serverApi","$stateParams","funcFactory",function(t,e,a,r,n){function o(){e.go("app.partners",{})}function i(){e.go("app.partners.view.edit",{})}var s=t;s.partner={},s.visual={navButtsOptions:[{type:"back",callback:o},{type:"edit",callback:i},{type:"files"}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},titles:window.gon.index.Partner.objectTitle+": "},s.newPerson={},a.getPartnerDetails(r.id,function(t){console.log(t.data),s.partner=t.data,a.getCustomerOrders(1,"-"+s.partner.prefix+"-",{},function(t){console.log("CustomerOrders: ",t),s.partner.customerOrders=t.data}),a.getDispatchOrders(1,"-"+s.partner.prefix+"-",{},function(t){console.log("DispatchOrders: ",t),s.partner.dispatchOrders=t.data})}),s.createPerson=function(){$("#createPersonModal").modal("show")},s.clearPerson=function(){s.newPerson={},s.passport_scan=s.person_photo=""},s.addNewPerson=function(){var t={person:s.newPerson};a.createPerson(s.partner.id,t,function(t){t.data.errors?n.showNotification("Не удалось создать представителя",t.data.errors):(n.showNotification("Представитель успешно добавлен","",!0),s.partner.people.push(t.data),s.clearNewPartnerData())})},s.appendScanHandler=function(t){s.passport_scan=t.name,s.newPerson.passport_scan=t},s.appendPersonPhotoHandler=function(t){s.person_photo=t.name,s.newPerson.person_photo=t}}])}(),function(){angular.module("app.products").controller("EditProductCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(t){s.fileModalOptions={url:"/api/products/"+t.id+"/image",files:[t.image],r_delete:r.deleteImage,view:"products",id:t.id,filesCount:1,sending:function(t,e,a){var r=this.serverFiles,n=this.files;r.length>0&&r[0]&&(this.removeFile(r[0]),r.splice(0,1)),n.length>1&&this.removeFile(n[0]),a.append("title",t.title)},complete:function(e){t.image_url="/uploads/"+e.id+"/original"+this.cutExtension(e.name).extension,!s.$$phase&&s.$apply(angular.noop)},dropzoneConfig:{acceptedFiles:".jpg,.png,.gif"}}}function i(){e.go("app.product",a)}var s=t;s.data={product:{},manufacturers:[],catalogues:[]},s.visual={navButtsOptions:[{type:"show",callback:i}],roles:{},showFileModal:angular.noop},s.tinymceOptions=n.getTinymceOptions(),s.mSelectConfig={dataMethod:r.getManufacturers},s.cselectConfig={dataMethod:r.getCatalogues},r.getProduct(a.id,function(t){console.log(t.data);var e=s.data.product=t.data;e.vat_rate.selected=e.vat_rate.selected.toString(),s.visual.roles={can_edit:e.can_edit,can_destroy:e.can_destroy},o(e)}),s.saveProduct=function(){var t=s.data.product,e={product:{name:t.name,description:t.description,article:t.article,manufacturer_id:t.manufacturer.id,catalogue_ids:(t.catalogues||[]).map(function(t){return t.id}),type:t.type.selected,unit:t.unit.selected,vat_rate:t.vat_rate.selected,weight:t.weight}};r.updateProduct(t.id,e,function(e){console.log(e),e.data.errors?n.showNotification("Не удалось отредактировать категорию "+t.name,e.data.errors):n.showNotification("Успешно","Товар "+t.name+" успешно отредактирована.",!0)})}}])}(),function(){"use strict";angular.module("app.products").controller("PartnerLogsProductCtrl",["$scope","$stateParams","serverApi","$state","funcFactory",function(t,e,a,r,n){function o(){r.go("app.product.edit",e)}function i(){r.go("app.product",e)}function s(t){a.deleteProductPartnerLog(c.product.id,t.id,function(e){if(e.data.errors)n.showNotification("Не удалось удалить лог",e.data.errors);else{for(var a=0;a<c.partner_logs.other_logs.length;a++)if(c.partner_logs.other_logs[a].id===t.id){c.partner_logs.other_logs.splice(a,1);break}for(var a=0;a<c.partner_logs.mfk_logs.length;a++)if(c.partner_logs.mfk_logs[a].id===t.id){c.partner_logs.mfk_logs.splice(a,1);break}n.showNotification("Лог удален:",t.human_name,!0)}})}var c=t;c.visual={navButtsOptions:[{type:"edit",callback:o},{type:"show",callback:i}],navTableButts:[{type:"remove",callback:s}]},c.product={},c.partner_logs=[],a.getProduct(e.id,function(t){c.product=t.data}),a.getProductPartnerLogs(e.id,function(t){c.partner_logs=t.data})}])}(),function(){"use strict";angular.module("app.products").controller("ProductCtrl",["$scope","$stateParams","serverApi","$state","funcFactory",function(t,e,a,r,n){function o(){r.go("app.product.edit",e)}function i(){r.go("app.product.partner_logs",e)}function s(){r.go("app.product.supplier_infos",e)}var c=t;c.visual={navButtsOptions:[{type:"edit",callback:o},{type:"logs",callback:i},{type:"at_partners",callback:s}],roles:{}},c.product={},c.data={quantity:0},a.getProduct(e.id,function(t){c.product=t.data,console.log(t.data)}),c.getLeadTime=function(t,e){13==event.keyCode&&a.getLeadTime(t,e,function(t){var e=t.data.lead_time_info;n.showNotification("Успешно","Тариф: "+e.price_tarif+" руб., Скидка: "+e.discount+"%, Закупка: "+e.cost+" руб., Срок поставки: "+e.delivery_date+", Мин. кол-во: "+e.quantity_min,!0)})}}])}(),function(){"use strict";angular.module("app.products").controller("SupplierInfosProductCtrl",["$scope","$stateParams","serverApi","$state",function(t,e,a,r){function n(){r.go("app.product.edit",e)}function o(){r.go("app.product",e)}var i=t;i.visual={navButtsOptions:[{type:"edit",callback:n},{type:"show",callback:o}],navTableButts:[{type:"view"},{type:"table_edit"},{type:"remove"}]},i.product={},i.supplier_infos=[],a.getProduct(e.id,function(t){i.product=t.data}),a.getProductSupplierInfos(e.id,function(t){i.supplier_infos=t.data})}])}(),function(){angular.module("app.receive_orders").controller("EditReceiveOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(){u.data.productForAppend={country:"",gtd:"",quantity:0,total:0}}function i(t,e,a){var o=function(){var e=t.data,a={quantity:e.quantity,country:e.country||"",gtd:e.gtd||"",total_w_vat:e.total};r.updateReceiveOrderContents(u.receiveOrder.id,e.id,a,function(a){if(a.data.errors)n.showNotification("Не удалось обновить продукт "+e.product.name,a.data.errors);else{var r=u.receiveOrder.product_order_contents;r[t.index]=angular.extend(r[t.index],a.data),n.showNotification("Успешно","Продукт "+e.product.name+" успешно обновлен",!0)}})};a?13==a.keyCode&&o():o()}function s(t){var e=t.data;r.deleteReceiveOrderContents(u.receiveOrder.id,e.id,function(a){a.data.errors?n.showNotification("Не удалось удалить продукт "+e.product.name,a.data.errors):(n.showNotification("Успешно","Продукт "+e.product.name+" успешно удален",!0),u.receiveOrder.product_order_contents.splice(t.index,1))})}function c(){e.go("app.receive_orders",a)}function l(){e.go("app.receive_orders.view",a)}function d(){u.visual.showFileModal()}var u=t;u.receiveOrder={},u.visual={navButtsOptions:[{type:"back",callback:c},{type:"show",callback:l},{type:"files",callback:d}],navTableButts:[{type:"table_edit",callback:i},{type:"remove",callback:s}],roles:{can_edit:!0,can_destroy:!0},showFileModal:angular.noop,titles:"Редактировать "+window.gon.index.ReceiveOrder.objectTitle.toLowerCase()},u.data={},u.productSelectConf={dataMethod:function(t,e,n,o){t>1?o({data:[]}):r.getUnreceivedProducts(a.id,e,n,o)}},o(),r.getReceiveOrderDetails(a.id,function(t){if(t.data.errors)n.showNotification("Ошибка загрузки данных",t.data.errors);else{var e=u.receiveOrder=t.data;n.setPageTitle("Поступление "+u.receiveOrder.number),u.fileModalOptions={url:"/api/receive_orders/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"receive_orders",
id:e.id}}}),u.appendOrder=function(t){var e=function(){var t=u.data.productForAppend,e={product_id:t.product.id,quantity:t.quantity,country:t.country||"",gtd:t.gtd||"",total_w_vat:t.total,supplier_order_id:t.supplier_order.id};r.createReceiveOrderContents(u.receiveOrder.id,e,function(e){e.data.errors?n.showNotification("Не удалось добавить продукт "+t.product.name,e.data.errors):(n.showNotification("Успешно","Продукт "+t.product.name+" успешно добвален",!0),u.receiveOrder.product_order_contents.push(angular.extend(t,e.data)),o())})},a=u.data.productForAppend.product;a&&a.id&&(t?13==t.keyCode&&e():e())},u.updateContentsProduct=i,u.initMaxValue=function(t,e){t[e+"_max"]=t[e]},u.onSelectProduct=function(t){t.total_max=t.total,t.quantity_max=t.quantity},u.saveReceiveOrderInfo=function(){var t=u.receiveOrder,e={receive_order:{number:t.number,vat_code:t.vat_code,partner_id:t.partner.id,date:t.date}};r.updateReceiveOrder(t.id,e,function(e){200!=e.status||e.data.errors?n.showNotification("Неудача","Не удалось отредактировать заказ "+t.number,!0):n.showNotification("Успешно","Заказ "+t.number+" успешно отредактирован.",!0)})}}])}(),function(){"use strict";angular.module("app.receive_orders").controller("ReceiveOrdersCtrl",["$scope","$state","$stateParams","serverApi","CanCan","funcFactory",function(t,e,a,r,n,o){function i(){d.newOrderData.date=new Date,$("#createNewReceiveOrderModal").modal("show")}function s(t){e.go("app.receive_orders.view",{id:t.data.id||t.data._id})}function c(t){e.go("app.receive_orders.view.edit",{id:t.data.id||t.data._id})}function l(t){$.SmartMessageBox({title:"Удалить заказ?",content:"Вы действительно хотите удалить поступление "+t.data.number,buttons:"[Нет][Да]"},function(e){"Да"===e&&r.deleteReceiveOrder(t.data.id,function(e){e.data.errors?o.showNotification("Не удалось удалить поступление "+t.data.number,e.data.errors):(d.data.ordersList.splice(t.index,1),o.showNotification("Поступление "+t.data.number+" успешно удалено.","",!0))})})}var d=t;d.visual={navButtsOptions:[{type:"new",callback:i}],navTableButts:[{type:"view",callback:s},{type:"table_edit",callback:c},{type:"remove",callback:l}],role:{can_edit:n.can("edit","ReceiveOrder"),can_destroy:n.can("destroy","ReceiveOrder")},titles:[window.gon.index.ReceiveOrder.indexTitle]},d.data={ordersList:[],partnersList:[],searchQuery:a.q},d.partnerSelectConfig={dataMethod:r.getPartners},d.newOrderData={},d.addNewOrder=function(){var t={date:d.newOrderData.date,number:d.newOrderData.number,vat_code:d.newOrderData.vat_code,partner_id:d.newOrderData.partner.id};r.createReceiveOrder(t,function(t){t.data.errors?o.showNotification("Не удалось создать поступление",t.data.errors):(d.data.ordersList.unshift(t.data),o.showNotification("Поступление успешно создано","",!0),d.clearCreateOrder(),e.go("app.receive_orders.view.edit",{id:t.data.id}))})},d.clearCreateOrder=function(){d.newOrderData={}}}])}(),function(){"use strict";angular.module("app.receive_orders").controller("ViewReceiveOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(){e.go("app.receive_orders",{})}function i(){c.visual.showFileModal()}function s(){e.go("app.receive_orders.view.edit",a)}var c=t;c.receiveOrder={},c.visual={navButtsOptions:[{type:"back",callback:o},{type:"files",callback:i},{type:"edit",callback:s}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,titles:window.gon.index.ReceiveOrder.objectTitle+": #"},c.amontPercent=0,c.receivedPercent=0,r.getReceiveOrderDetails(a.id,function(t){console.log(t.data);var e=c.receiveOrder=t.data;n.setPageTitle("Поступление "+c.receiveOrder.number),c.amontPercent=n.getPercent(e.paid_amount,e.total),c.receivedPercent=n.getPercent(e.receivedPercent,e.total),c.fileModalOptions={url:"/api/receive_orders/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"receive_orders",id:e.id}})}])}(),function(){"use strict";angular.module("app.search").controller("TopSearchCtrl",["$scope","$stateParams","$location","$state","serverApi","CanCan",function(t,e,a,r,n,o){function i(t){r.go("app.product",{id:t})}function s(t){r.go("app.product.edit",{id:t})}var c=t;c.data={searchText:decodeURIComponent(e.searchString),searchList:[]},c.visual={navButtsOptions:[{type:"view",callback:i},{type:"table_edit",callback:s},{type:"remove"}],role:{can_edit:o.can("Product","edit"),can_destroy:o.can("Product","destroy")}}}])}(),function(){angular.module("app.supplier_orders").controller("EditSupplierOrderCtrl",["$scope","$state","$stateParams","serverApi","$filter","funcFactory",function(t,e,a,r,n,o){function i(t,e,a){var n=function(){var e={quantity:t.data.quantity};r.updateSupplierOrderProduct(p.data.supplierOrder.id,t.data.id,e,function(e){if(e.data.errors)o.showNotification("Не удалось обновить данные продукта",e.data.errors);else{var a=p.data.supplierOrder.supplier_order_contents[t.index];p.data.supplierOrder.supplier_order_contents[t.index]=angular.extend(a,e.data),o.showNotification("Успешно обновлены данные продукта",t.data.product.name,!0)}})};a?13==a.keyCode&&n():n()}function s(t){r.removeSupplierOrderProduct(p.data.supplierOrder.id,t.data.id,function(e){e.data.errors?o.showNotification("Не удалось удалить продукт",e.data.errors):(p.data.supplierOrder.supplier_order_contents.splice(t.index,1),o.showNotification("Продукт удален:",t.data.product.name,!0))})}function c(t,e){var n={supplier_order:{event:e.event}};r.updateStatusSupplierOrder(a.id,n,function(t){200!=t.status||t.data.errors?o.showNotification("Не удалось "+e.name.toLowerCase()+" заказ",t.data.errors):(o.showNotification("Успешно","Удалось "+e.name.toLowerCase()+" заказ",!0),p.data.supplierOrder=t.data)})}function l(){e.go("app.supplier_orders.view",a)}function d(){e.go("app.supplier_orders",a)}function u(){p.visual.showFileModal()}var p=t;p.data={supplierOrder:{},partnersList:[],productsList:[],total:0},p.productForAppend={},p.visual={navButtsOptions:[{type:"back",callback:d},{type:"show",callback:l},{type:"files",callback:u},{type:"confirm_order",callback:c}],navTableButts:[{type:"table_edit",disabled:!1,callback:i},{type:"remove",disabled:!1,callback:s}],roles:{can_destroy:!0,can_edit:!0},showFileModal:angular.noop,titles:"Редактировать "+window.gon.index.SupplierOrder.objectTitle.toLowerCase()},p.pSelectConfig={startPage:0,dataMethod:r.getSearch},p.partnerSelectConfig={dataMethod:r.getPartners},r.getSupplierOrderDetails(a.id,function(t){var e=p.data.supplierOrder=t.data;p.data.supplierOrder.date=n("date")(t.data.date,"dd.MM.yyyy HH:mm"),p.visual.roles.can_confirm=e.can_confirm,p.fileModalOptions={url:"/api/supplier_orders/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"supplier_orders",id:e.id}}),p.saveOrderInfo=function(){var t=p.data.supplierOrder,e={supplier_order:{title:t.title,description:t.description,partner_id:t.partner.id,number:t.number}};r.updateSupplierOrder(t.id,e,function(e){200!=e.status||e.data.errors?$.smallBox({title:"Ошибка",content:"<i class='fa fa-edit'></i> <i>Не смог обновить заказ "+t.number+".</i>",color:"#A90329",iconSmall:"fa fa-close fa-2x fadeInRight animated",timeout:4e3}):$.smallBox({title:"Успешно",content:"<i class='fa fa-edit'></i> <i>Заказ "+t.number+" успешно отредактирован.</i>",color:"#739E73",iconSmall:"fa fa-check fa-2x fadeInRight animated",timeout:4e3})})},p.selectProductForAppend=function(t){p.productForAppend=t,p.productForAppend.id=t.id||t._id,p.productForAppend.quantity=0,t.hasOwnProperty("discount")||(p.productForAppend.discount=0)},p.appendProduct=function(t){var e=function(){var t=p.productForAppend,e=angular.extend(t,{product:{name:t.name,id:t.id}}),a={product_id:t.id,quantity:t.quantity,discount:t.discount};r.addSupplierOrderProduct(p.data.supplierOrder.id,a,function(a){a.data.errors?o.showNotification("Не удалось добавить продукт",a.data.errors):(p.productForAppend={},p.data.selectedProduct=null,p.data.supplierOrder.supplier_order_contents.push(angular.extend(e,a.data)),o.showNotification("Успешно добавлен продукт",t.name,!0))})};t?13==t.keyCode&&e():e()},p.updateProductOfOrder=i,p.$watch("data.supplierOrder.supplier_order_contents",function(t){if(t){var e=0;t.map(function(t){e+=n("price_net")(t,t.quantity)}),p.data.total=e}},!0),p.focusOnProduct=function(){window.setTimeout(function(){angular.element("#append_product_quantity")[0].focus()},0)}}])}(),function(){"use strict";angular.module("app.supplier_orders").controller("SupplierOrdersCtrl",["$scope","$state","$stateParams","serverApi","$filter","CanCan","funcFactory",function(t,e,a,r,n,o,i){function s(t){e.go("app.supplier_orders.view",{id:t.data.id||t.data._id})}function c(t){e.go("app.supplier_orders.view.edit",{id:t.data.id||t.data._id})}function l(){p.newOrderData.date=n("date")(new Date,"dd.MM.yyyy HH:mm"),$("#createNewOrderModal").modal("show")}function d(){r.automaticallyCreateSupplierOrders(function(t){if(t.data.errors)i.showNotification("Не удалось создать заказы");else{for(var e=0;e<t.data.supplier_orders.length;e++)p.data.ordersList.unshift(t.data.supplier_orders[e]);i.showNotification("Успешно","Всё сделал",!0)}})}function u(t){var e=t.data;$.SmartMessageBox({title:"Удалить заказ?",content:"Вы действительно хотите удалить заказ "+e.number,buttons:"[Нет][Да]"},function(a){"Да"===a&&r.deleteSupplierOrder(e.id,function(a){a.data.errors?i.showNotification("Не удалось удалить заказ "+e.number):(console.log(a),p.data.ordersList.splice(t.index,1),i.showNotification("Успешно","Заказ "+e.number+" удален",!0))})})}var p=t;p.visual={navButtsOptions:[{type:"new",callback:l},{type:"automatically",callback:d}],navTableButts:[{type:"view",callback:s},{type:"table_edit",callback:c},{type:"remove",callback:u}],canAddPartner:o.can("see_multiple","Partner"),titles:[window.gon.index.SupplierOrder.indexTitle]},p.data={ordersList:[],searchQuery:a.q},p.newOrderData={date:null}}])}(),function(){"use strict";angular.module("app.supplier_orders").controller("ViewSupplierOrderCtrl",["$scope","$state","$stateParams","serverApi","funcFactory",function(t,e,a,r,n){function o(t,e){var o={supplier_order:{event:e.event}};r.updateStatusSupplierOrder(a.id,o,function(t){200!=t.status||t.data.errors?n.showNotification("Не удалось "+e.name.toLowerCase()+" заказ",t.data.errors):(n.showNotification("Успешно","Удалось "+e.name.toLowerCase()+" заказ",!0),l.order=t.data)})}function i(){e.go("app.supplier_orders.view.edit",a)}function s(){e.go("app.supplier_orders",{})}function c(){l.visual.showFileModal()}var l=t;l.order={},l.visual={navButtsOptions:[{type:"back",callback:s},{type:"files",callback:c},{type:"edit",callback:i},{type:"confirm_order",callback:o}],chartOptions:{barColor:"rgb(103,135,155)",scaleColor:!1,lineWidth:5,lineCap:"circle",size:50},showFileModal:angular.noop,titles:window.gon.index.SupplierOrder.objectTitle+": #"},l.amontPercent=0,l.dispatchedPercent=0,r.getSupplierOrderDetails(a.id,function(t){console.log(t.data);var e=l.order=t.data;l.amontPercent=n.getPercent(e.paid_amount,e.total),l.dispatchedPercent=n.getPercent(e.received_amount,e.total),l.visual.roles={can_confirm:e.can_confirm},l.fileModalOptions={url:"/api/supplier_orders/"+e.id+"/documents",files:e.documents,r_delete:r.deleteFile,view:"supplier_orders",id:e.id}})}])}(),window.appConfig={},appConfig.menu_speed=200,appConfig.serverUrl="http://localhost:3000",appConfig.smartSkin="smart-style-0",appConfig.skins=[{name:"smart-style-0",logo:"styles/img/logo.png","class":"btn btn-block btn-xs txt-color-white margin-right-5",style:"background-color:#4E463F;",label:"Smart Default"},{name:"smart-style-1",logo:"styles/img/logo-white.png","class":"btn btn-block btn-xs txt-color-white",style:"background:#3A4558;",label:"Dark Elegance"}],appConfig.sound_path="/app/sound/",appConfig.sound_on=!0,function(t){$.sound_path=appConfig.sound_path,$.sound_on=appConfig.sound_on;var e=t.module("app",["ngSanitize","ngAnimate","ui.router","ui.bootstrap","infinite-scroll","ui.select","ui.tinymce","cancan.export","app.layout","login","app.templates","app.search","app.dashboard","app.customer_orders","app.dispatch_orders","app.contacts","app.partners","app.supplier_orders","app.catalogues","app.manufacturers","app.pdf_catalogues","app.incoming_transfers","app.outgoing_transfers","app.receive_orders","app.products","app.articles","app.news","app.pages"]);e.config(["$provide","$httpProvider",function(t,e){e.defaults.headers.common["X-CSRF-Token"]=$("meta[name=csrf-token]").attr("content"),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.common.Accept="application/json;charset=utf-8",e.defaults.headers.common["Content-Type"]="application/json; charset=utf-8",t.factory("ErrorHttpInterceptor",["$q","$rootScope",function(t,e){function a(t){console.log(t),$.bigBox({title:t.status+" "+t.statusText,content:t.data,color:"#C46A69",icon:"fa fa-warning shake animated",number:++n,timeout:6e3})}function r(t){e.showRibbonLoader=t}var n=0;return{request:function(t){var e=encodeURI(t.url);return t.url="GET"==t.method&&e.indexOf("html")>-1?e:appConfig.serverUrl+e,r(!0),t},response:function(t){return r(!1),t},requestError:function(e){return r(!1),a(e),t.reject(e)}}}]),e.interceptors.push("ErrorHttpInterceptor")}]),e.run(["$rootScope","$state","$stateParams","CanCan","Abilities",function(e,a,r,n,o){e.$state=a,e.$stateParams=r;var i=window.authorized=$('meta[name="user-id"]').attr("content");i||a.transitionTo("login",null),e.$on("$stateChangeSuccess",function(){"app.search"!==a.current.name&&t.element("body").scrollTop(0)}),e.$on("$stateChangeStart",function(t,e,r,i,s){if(!window.authorized&&""!==e.name)return t.preventDefault(),0;"login"==e||window.gon||(t.preventDefault(),o.getGon(e.name,r));var c=(e.data||{}).access;if(c){var l=n.can(c.action,c.params);l||(t.preventDefault(),a.transitionTo("app.dashboard",null,{reload:!0}))}})}]),Array.prototype.swapItemByindex=function(t,e){var a=this.splice(t,1)[0];this.splice(e,0,a)}}(window.angular);